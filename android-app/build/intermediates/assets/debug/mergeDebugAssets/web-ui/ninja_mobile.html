<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NEON-NOC // Mobile</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg0:#000;
      --glass: rgba(10, 25, 10, 0.52);
      --glass2: rgba(0,0,0,0.35);

      --glow-green:#4ade80;
      --glow-cyan:#22d3ee;
      --glow-purple:#a855f7;

      --border-green: rgba(74, 222, 128, 0.40);
      --border-cyan: rgba(34, 211, 238, 0.35);
      --border-purple: rgba(168, 85, 247, 0.35);

      --text-green: #a3b1a3;
      --text-dim: rgba(163,177,163,0.75);

      --ok: #22c55e;
      --warn: #eab308;
      --bad: #ef4444;

      --shadow: 0 0 25px rgba(0,0,0,0.55);
      --radius: 16px;
      --radius-sm: 10px;

      --gap: 12px;

      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
    }

    *{ box-sizing:border-box; }
    html, body { height:100%; }
    body{
      margin:0;
      font-family:'Share Tech Mono', monospace;
      background: var(--bg0);
      color: var(--text-green);
      overflow-x:hidden;
      text-shadow: 0 0 5px rgba(100,255,100,0.25);
    }

    /* CRT scanline overlay */
    body::after{
      content:"";
      position:fixed; inset:0;
      pointer-events:none;
      z-index: 1000;
      background:
        linear-gradient(rgba(18,16,16,0) 50%, rgba(0,0,0,0.25) 50%),
        linear-gradient(90deg, rgba(255,0,0,0.06), rgba(0,255,0,0.02), rgba(0,0,255,0.06));
      background-size: 100% 2px, 3px 100%;
      animation: flicker .15s infinite;
      opacity:.55;
    }
    @keyframes flicker{
      0% { opacity: 0.25; } 20% { opacity: 0.85; } 40% { opacity: 0.35; }
      60% { opacity: 0.95; } 80% { opacity: 0.30; } 100% { opacity: 0.55; }
    }

    /* Neon animated background */
    .bg{
      position:fixed; inset:0;
      z-index:-2;
      background:
        radial-gradient(1000px 600px at 20% 15%, rgba(34,211,238,0.10), transparent 55%),
        radial-gradient(900px 520px at 82% 25%, rgba(168,85,247,0.10), transparent 50%),
        radial-gradient(1200px 720px at 50% 90%, rgba(74,222,128,0.08), transparent 55%),
        linear-gradient(180deg, rgba(0,0,0,1), rgba(0,0,0,0.92));
      filter:saturate(120%);
    }
    .bg::before{
      content:"";
      position:absolute; inset:-10%;
      background:
        repeating-linear-gradient(0deg, rgba(34,211,238,0.06) 0 1px, transparent 1px 26px),
        repeating-linear-gradient(90deg, rgba(168,85,247,0.05) 0 1px, transparent 1px 30px);
      transform: perspective(900px) rotateX(55deg) translateY(140px);
      transform-origin: center;
      opacity:0.35;
      filter: blur(0.25px);
      animation: gridScroll 10s linear infinite;
    }
    @keyframes gridScroll{
      from{ background-position: 0 0, 0 0; }
      to{ background-position: 0 260px, 300px 0; }
    }

    /* Window */
    .window{
      background: var(--glass);
      border: 1px solid var(--border-green);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px) saturate(120%);
      -webkit-backdrop-filter: blur(10px) saturate(120%);
      overflow:hidden;
      position:relative;
    }
    .window.cyan { border-color: var(--border-cyan); }
    .window.purple { border-color: var(--border-purple); }

    .titlebar{
      background: var(--glass2);
      border-bottom: 1px solid rgba(255,255,255,0.04);
      padding: 10px 12px;
      display:flex;
      align-items:center;
      gap:10px;
      user-select:none;
    }
    .win-controls{ display:flex; gap:6px; }
    .win-controls span{
      width:12px; height:12px; border-radius:50%;
      background:#222; border: 1px solid #444;
      display:block;
    }
    .win-controls span:nth-child(1){ background:#ef4444; }
    .win-controls span:nth-child(2){ background:#eab308; }
    .win-controls span:nth-child(3){ background:#22c55e; }

    .title{
      display:flex; align-items:center; gap:10px;
      width:100%;
      min-width:0;
    }
    .title h1, .title h2{
      margin:0;
      font-size: 13px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: rgba(163,177,163,0.95);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .badge{
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.08);
      color: rgba(255,255,255,0.75);
      background: rgba(0,0,0,0.35);
      white-space:nowrap;
    }
    .monoDim{ color: rgba(163,177,163,0.7); font-size: 12px; letter-spacing: 1px; }

    /* Inputs */
    .input, .select{
      background: rgba(0,0,0,0.45);
      border: 1px solid rgba(255,255,255,0.08);
      color: rgba(255,255,255,0.78);
      border-radius: 10px;
      padding: 10px 10px;
      outline:none;
      font-family: inherit;
      font-size: 12px;
      letter-spacing: 1px;
      width:100%;
    }
    .input:focus, .select:focus{
      border-color: rgba(34,211,238,0.45);
      box-shadow: 0 0 0 3px rgba(34,211,238,0.12);
    }

    /* Buttons */
    .btn{
      background: transparent;
      border: 1px solid var(--border-green);
      color: var(--text-green);
      padding: 11px 12px;
      font-family: inherit;
      letter-spacing: 1px;
      font-weight: 700;
      transition: all .18s ease;
      text-transform: uppercase;
      border-radius: 10px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      user-select:none;
      font-size: 12px;
      white-space:nowrap;
      min-height: 42px; /* touch */
    }
    .btn:hover{
      background: rgba(74,222,128,0.18);
      color: #fff;
      border-color: var(--glow-green);
      text-shadow: 0 0 8px rgba(74,222,128,0.8);
      box-shadow: 0 0 14px rgba(74,222,128,0.10);
    }
    .btn:disabled{
      border-color: rgba(71,85,105,0.35);
      color: rgba(255,255,255,0.25);
      cursor:not-allowed;
      background: transparent;
      text-shadow:none;
      box-shadow:none;
    }
    .btn.cyan{ border-color: var(--border-cyan); color: rgba(34,211,238,0.85); }
    .btn.cyan:hover{
      background: rgba(34,211,238,0.16);
      border-color: var(--glow-cyan);
      text-shadow: 0 0 10px rgba(34,211,238,0.9);
      box-shadow: 0 0 16px rgba(34,211,238,0.10);
    }
    .btn.purple{ border-color: var(--border-purple); color: rgba(168,85,247,0.85); }
    .btn.purple:hover{
      background: rgba(168,85,247,0.16);
      border-color: var(--glow-purple);
      text-shadow: 0 0 10px rgba(168,85,247,0.9);
      box-shadow: 0 0 16px rgba(168,85,247,0.10);
    }
    .btn.danger{ border-color: rgba(239,68,68,0.50); color: rgba(239,68,68,0.85); }
    .btn.danger:hover{ background: rgba(239,68,68,0.18); border-color: #ef4444; text-shadow: 0 0 10px rgba(239,68,68,0.8); }

    /* Status */
    .status{
      display:flex; align-items:center; gap:10px;
      border: 1px solid rgba(255,255,255,0.07);
      background: rgba(0,0,0,0.35);
      padding: 8px 10px;
      border-radius: 12px;
      width: 100%;
    }
    .statusLight{
      width: 12px; height: 12px;
      border-radius: 50%;
      background: #444;
      transition: background-color .4s ease, box-shadow .4s ease;
      flex: 0 0 auto;
    }
    .statusLight.ok{ background: var(--ok); box-shadow: 0 0 14px rgba(34,197,94,0.8); }
    .statusLight.warn{ background: var(--warn); box-shadow: 0 0 14px rgba(234,179,8,0.75); }
    .statusLight.bad{ background: var(--bad); box-shadow: 0 0 14px rgba(239,68,68,0.75); }

    /* Chips */
    .chips{ display:flex; gap:8px; flex-wrap:wrap; }
    .chip{
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.35);
      color: rgba(255,255,255,0.68);
      padding: 7px 10px;
      border-radius: 999px;
      cursor:pointer;
      transition: all .15s ease;
      font-size: 11px;
      letter-spacing: 1px;
      user-select:none;
      min-height: 34px;
      display:inline-flex;
      align-items:center;
    }
    .chip:hover{ border-color: rgba(34,211,238,0.35); color: rgba(34,211,238,0.9); }
    .chip.on{
      border-color: rgba(168,85,247,0.45);
      color: rgba(168,85,247,0.95);
      box-shadow: 0 0 12px rgba(168,85,247,0.10);
    }

    /* Cards / kv */
    .card{
      border: 1px solid rgba(255,255,255,0.06);
      background: rgba(0,0,0,0.28);
      border-radius: 14px;
      padding: 10px;
    }
    .cardTitle{
      font-size: 12px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: rgba(255,255,255,0.70);
      margin-bottom: 8px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 8px;
      min-width: 0;
    }
    .kv{
      display:grid;
      grid-template-columns: 120px 1fr;
      gap: 6px 10px;
      font-size: 12px;
      color: rgba(255,255,255,0.72);
    }
    .k{ color: rgba(163,177,163,0.7); }
    .v{ color: rgba(255,255,255,0.80); overflow:hidden; text-overflow:ellipsis; }

    .pill{
      display:inline-flex; align-items:center; gap:6px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.25);
      font-size: 11px;
      color: rgba(255,255,255,0.70);
      white-space:nowrap;
    }
    .dot{
      width:7px; height:7px; border-radius:50%;
      background:#666;
    }
    .dot.ok{ background: var(--ok); box-shadow: 0 0 8px rgba(34,197,94,0.65); }
    .dot.bad{ background: var(--bad); box-shadow: 0 0 8px rgba(239,68,68,0.65); }
    .dot.warn{ background: var(--warn); box-shadow: 0 0 8px rgba(234,179,8,0.55); }

    .prog{
      height: 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.06);
      overflow:hidden;
    }
    .prog > i{
      display:block;
      height:100%;
      width: 0%;
      background: linear-gradient(90deg, rgba(34,211,238,0.85), rgba(168,85,247,0.85), rgba(74,222,128,0.75));
      box-shadow: 0 0 14px rgba(34,211,238,0.25);
      transition: width .35s ease;
    }

    .sep{ height:1px; background: rgba(255,255,255,0.05); margin: 10px 0; }
    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .grow{ flex:1; min-width: 0; }

    /* Mobile shell layout */
    .shell{
      min-height:100%;
      display:flex;
      flex-direction:column;
      padding: calc(10px + var(--safe-top)) 10px calc(78px + var(--safe-bottom)) 10px;
      gap: var(--gap);
    }

    .topbar .content{
      padding: 10px 12px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .topbar .titlebar{
      padding-top: calc(10px + var(--safe-top));
    }

    .topRow{
      display:flex;
      gap:10px;
      align-items:center;
    }
    .hamburger{
      width: 42px;
      height: 42px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.35);
      color: rgba(255,255,255,0.75);
      display:flex; align-items:center; justify-content:center;
      cursor:pointer;
      user-select:none;
    }
    .hamburger:active{ transform: scale(0.98); }
    .hamburger i{
      width: 18px; height: 2px;
      background: rgba(255,255,255,0.70);
      position:relative;
      display:block;
    }
    .hamburger i::before, .hamburger i::after{
      content:"";
      position:absolute;
      left:0;
      width: 18px; height: 2px;
      background: rgba(255,255,255,0.70);
    }
    .hamburger i::before{ top:-6px; }
    .hamburger i::after{ top:6px; }

    .main{
      display:flex;
      flex-direction:column;
      gap: var(--gap);
    }

    /* Bottom nav */
    .bottomNav{
      position:fixed;
      left:0; right:0; bottom:0;
      padding: 10px 10px calc(10px + var(--safe-bottom)) 10px;
      background: rgba(0,0,0,0.72);
      backdrop-filter: blur(10px) saturate(120%);
      border-top: 1px solid rgba(255,255,255,0.06);
      z-index: 900;
    }
    .navGrid{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:10px;
    }
    .navBtn{
      min-height: 44px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.08);
      background: rgba(0,0,0,0.30);
      color: rgba(255,255,255,0.72);
      font-family: inherit;
      font-size: 11px;
      letter-spacing: 1px;
      text-transform: uppercase;
      cursor:pointer;
      user-select:none;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding: 8px 6px;
      transition: all .15s ease;
    }
    .navBtn.active{
      border-color: rgba(168,85,247,0.45);
      color: rgba(168,85,247,0.95);
      box-shadow: 0 0 14px rgba(168,85,247,0.10);
    }
    .navBtn:active{ transform: scale(0.99); }

    /* Drawers */
    .drawerOverlay{
      position:fixed; inset:0;
      background: rgba(0,0,0,0.70);
      display:none;
      z-index: 1100;
      padding: calc(10px + var(--safe-top)) 10px calc(10px + var(--safe-bottom)) 10px;
    }
    .drawerOverlay.show{ display:block; }
    .drawer{
      height:100%;
      width: min(520px, 100%);
      max-width: 100%;
      margin-left: auto;
      border-radius: 16px;
      overflow:hidden;
      transform: translateX(110%);
      transition: transform .18s ease;
    }
    .drawerOverlay.show .drawer{ transform: translateX(0%); }

    .sheetOverlay{
      position:fixed; inset:0;
      background: rgba(0,0,0,0.70);
      display:none;
      z-index: 1200;
      padding: 0 10px calc(10px + var(--safe-bottom)) 10px;
    }
    .sheetOverlay.show{ display:block; }
    .sheet{
      position:absolute;
      left:10px; right:10px;
      bottom: calc(10px + var(--safe-bottom));
      height: min(78vh, 720px);
      border-radius: 16px;
      overflow:hidden;
      transform: translateY(110%);
      transition: transform .18s ease;
    }
    .sheetOverlay.show .sheet{ transform: translateY(0%); }

    /* Device list: cards (mobile-first) */
    .deviceList{
      display:flex;
      flex-direction:column;
      gap: 10px;
    }
    .devCard{
      border: 1px solid rgba(255,255,255,0.06);
      background: rgba(0,0,0,0.28);
      border-radius: 14px;
      padding: 10px;
      cursor:pointer;
      transition: all .12s ease;
    }
    .devCard:hover{
      box-shadow: inset 0 0 0 1px rgba(34,211,238,0.14);
      background: rgba(34,211,238,0.05);
    }
    .devTop{
      display:flex; align-items:center; justify-content:space-between;
      gap: 10px;
      margin-bottom: 8px;
    }
    .devName{
      font-size: 12px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: rgba(255,255,255,0.78);
      min-width:0;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    .devMeta{
      display:flex;
      flex-wrap:wrap;
      gap: 8px;
    }

    /* Ops panel: terminal */
    .terminal{
      height: 100%;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.07);
      background: rgba(0,0,0,0.45);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height: 320px;
    }
    .termHead{
      display:flex; align-items:center; justify-content:space-between;
      padding: 8px 10px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      background: rgba(0,0,0,0.40);
      font-size: 12px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: rgba(255,255,255,0.70);
    }
    .termBody{
      padding: 10px;
      overflow:auto;
      font-size: 12px;
      color: rgba(34,211,238,0.85);
      line-height: 1.5;
      flex: 1;
    }
    .termLine.dim{ color: rgba(163,177,163,0.65); }
    .termLine.warn{ color: rgba(234,179,8,0.85); }
    .termLine.bad{ color: rgba(239,68,68,0.85); }
    .termLine.ok{ color: rgba(34,197,94,0.85); }

    .termInputRow{
      display:flex;
      gap: 8px;
      padding: 10px;
      border-top: 1px solid rgba(255,255,255,0.06);
      background: rgba(0,0,0,0.35);
    }
    .termPrompt{
      color: rgba(168,85,247,0.85);
      padding-top: 10px;
      font-size: 12px;
      white-space:nowrap;
    }
    .termInput{
      flex:1;
      background: rgba(0,0,0,0.55);
      border: 1px solid rgba(255,255,255,0.08);
      color: rgba(255,255,255,0.78);
      border-radius: 10px;
      padding: 10px;
      font-family: inherit;
      font-size: 12px;
      outline:none;
      min-height: 42px;
    }
    .termInput:focus{
      border-color: rgba(168,85,247,0.45);
      box-shadow: 0 0 0 3px rgba(168,85,247,0.12);
    }

    /* Desktop enhancement if opened wide */
    @media (min-width: 980px){
      .shell{
        padding: 14px;
        display:grid;
        grid-template-columns: 270px 1fr 420px;
        grid-template-rows: 64px 1fr 240px;
        gap: 14px;
      }
      .topbar{ grid-column: 1 / 4; grid-row: 1; }
      .main{ grid-column: 2; grid-row: 2; }
      .detailsDock{ grid-column: 3; grid-row: 2; display:block; }
      .sidebarDock{ grid-column: 1; grid-row: 2 / 4; display:block; }
      .opsDock{ grid-column: 2 / 4; grid-row: 3; display:block; }

      .bottomNav{ display:none; }
      .drawerOverlay, .sheetOverlay{ display:none !important; }

      .topbar .content{
        flex-direction:row;
        justify-content:space-between;
        align-items:center;
        gap: 12px;
      }
      .topRow{ width: 100%; }
      .hamburger{ display:none; }

      .dockBody{
        padding: 12px;
        height: calc(100% - 44px);
        display:flex;
        flex-direction:column;
        gap: 12px;
      }
      .opsDock .dockBody{
        display:grid;
        grid-template-columns: 1fr 420px;
        gap: 14px;
      }
    }

    /* Hidden docks on mobile */
    .sidebarDock, .detailsDock, .opsDock{ display:none; }

    /* Views */
    .view{ display:none; }
    .view.show{ display:block; }

    /* Tiny click feedback */
    button:active{ transform: scale(0.99); }
  </style>

<link rel="stylesheet" href="./neon_dash.css">
<link rel="stylesheet" href="./neon_btns.css">
<link rel="stylesheet" href="./neon_btns.adapter.css">
<link rel="stylesheet" href="./cool_btns.css">

<style>
  body{
    margin:0;
    font-family:'Share Tech Mono', monospace;
    background: var(--bg0);
    color: var(--text-green);
    overflow-x:hidden;
    overflow-y:auto;
    display:block;
  }
  .dashboard-ui{
    padding: 0;
    min-height: 100%;
    width: 100%;
    display:block;
  }
  .shell{ width:100%; max-width:100vw; }
  .topRow{ flex-wrap: wrap; }
  .hamburger{ width:44px; height:44px; }
  .btn{ min-height: 44px; }
  .input, .select{ min-height: 44px; }
  .termInput{ min-height: 44px; }
  .chip{ min-height: 44px; }

  .layout-hud{
    position:fixed;
    top: calc(10px + var(--safe-top));
    left:10px;
    z-index: 2001;
    font-size: 12px;
    letter-spacing: 1px;
    background: rgba(0,0,0,0.6);
    border: 1px solid rgba(34,211,238,0.4);
    padding: 8px 10px;
    border-radius: 10px;
    color: rgba(255,255,255,0.85);
    max-width: calc(100% - 20px);
    display:none;
  }
  body.debug-layout .layout-hud{ display:block; }
  body.debug-layout .layout-issue{ outline: 2px solid rgba(239,68,68,0.9); outline-offset: 2px; }
  body.debug-layout .layout-pass{ outline: 1px dashed rgba(34,197,94,0.55); outline-offset: 2px; }
</style>

</head>

<body>
<div id=\"three-js-canvas\"></div>
<div class=\"dashboard-ui\">
  <div class="bg"></div>

  <!-- MOBILE / RESPONSIVE SHELL -->
  <div class="shell">

    <!-- TOP BAR -->
    <section class="window cyan topbar">
      <div class="titlebar">
        <div class="win-controls"><span></span><span></span><span></span></div>
        <div class="title">
          <h1>NEON-NOC // Mobile</h1>
          <span class="badge" id="buildBadge">ENGINE: DISCONNECTED</span>
          <span class="badge" id="wsBadge">WS: IDLE</span>
        </div>
      </div>

      <div class="content">
        <div class="topRow">
          <div class="hamburger" id="openNav"><i></i></div>
          <div class="status grow">
            <div id="healthLight" class="statusLight warn"></div>
            <div style="min-width:0;">
              <div id="healthText" style="font-size:12px; letter-spacing:1px; color: rgba(255,255,255,0.75); white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">ENGINE: STARTUP (SIM)</div>
              <div class="monoDim" id="scanHint">Tap SCAN to stream results.</div>
            </div>
          </div>
          <a href="#" class="btn cyan neon-btn" id="scanBtn" style="min-width: 90px;"><span></span><span></span><span></span><span></span>SCAN</a>
        </div>

        <div class="row">
          <input class="input grow" id="search" placeholder="SEARCH: hostname / ip / mac / vendor / tag…" />
          <select class="select" id="scope" style="max-width: 180px;">
            <option value="lan">LAN</option>
            <option value="subnet">SUBNET</option>
            <option value="custom">CIDR</option>
          </select>
        </div>

        <div class="row">
          <a href="#" class="btn purple grow neon-btn" id="advancedBtn"><span></span><span></span><span></span><span></span>ADVANCED ▾</a>
          <a href="#" class="btn grow neon-btn" id="exportBtn"><span></span><span></span><span></span><span></span>EXPORT</a>
          <a href="#" class="btn danger grow neon-btn" id="panicBtn"><span></span><span></span><span></span><span></span>PANIC</a>
        </div>

        <!-- Advanced dropdown (inline) -->
        <div class="card" id="advancedMenu" style="display:none;">
          <div class="cardTitle">Advanced scan</div>
          <div class="kv">
            <div class="k">CIDR</div><div class="v"><input class="input" id="cidr" value="192.168.1.0/24"/></div>
            <div class="k">Mode</div>
            <div class="v">
              <select class="select" id="scanMode">
                <option value="fast">FAST</option>
                <option value="balanced" selected>BALANCED</option>
                <option value="deep">DEEP</option>
              </select>
            </div>
            <div class="k">Rate</div>
            <div class="v">
              <select class="select" id="rate">
                <option value="polite">POLITE</option>
                <option value="normal" selected>NORMAL</option>
                <option value="aggressive">AGGRESSIVE</option>
              </select>
            </div>
          </div>
          <div class="sep"></div>
          <div class="row">
            <a href="#" class="btn cyan grow neon-btn" id="runAdvanced"><span></span><span></span><span></span><span></span>RUN</a>
            <a href="#" class="btn grow neon-btn" id="closeAdvanced"><span></span><span></span><span></span><span></span>CLOSE</a>
          </div>
          <div class="monoDim">Providers: ICMP/ARP/mDNS; SSDP/SNMP optional.</div>
        </div>
      </div>
    </section>

    <!-- SIDEBAR DOCK (DESKTOP ONLY) -->
    <aside class="window sidebarDock">
      <div class="titlebar">
        <div class="win-controls"><span></span><span></span><span></span></div>
        <div class="title">
          <h2>Navigation</h2>
          <span class="badge" id="roleBadge">ROLE: ADMIN</span>
        </div>
      </div>
      <div class="dockBody">
        <div id="dockNav"></div>
        <div class="card">
          <div class="cardTitle">Quick status</div>
          <div class="kv">
            <div class="k">CIDR</div><div class="v" id="netCidr">192.168.1.0/24</div>
            <div class="k">Gateway</div><div class="v" id="netGw">192.168.1.1</div>
            <div class="k">Jobs</div><div class="v"><span class="pill"><span class="dot warn"></span><span id="jobsCount">0 active</span></span></div>
          </div>
        </div>
      </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="window cyan main">
      <div class="titlebar">
        <div class="win-controls"><span></span><span></span><span></span></div>
        <div class="title">
          <h2 id="mainTitle">Overview</h2>
          <span class="badge" id="streamBadge">STREAM: OFF</span>
        </div>
      </div>

      <div style="padding:12px; display:flex; flex-direction:column; gap: var(--gap);">
        <!-- Filters + bulk -->
        <div class="chips" id="chips">
          <div class="chip" data-chip="online">ONLINE</div>
          <div class="chip" data-chip="offline">OFFLINE</div>
          <div class="chip" data-chip="os:windows">OS: WINDOWS</div>
          <div class="chip" data-chip="os:linux">OS: LINUX</div>
          <div class="chip" data-chip="os:android">OS: ANDROID</div>
          <div class="chip" data-chip="tag:iot">TAG: IOT</div>
          <div class="chip" data-chip="tag:server">TAG: SERVER</div>
        </div>

        <div class="row">
          <a href="#" class="btn grow neon-btn" id="tagBtn" disabled><span></span><span></span><span></span><span></span>TAG</a>
          <a href="#" class="btn cyan grow neon-btn" id="bulkPingBtn" disabled><span></span><span></span><span></span><span></span>BULK PING</a>
          <a href="#" class="btn purple grow neon-btn" id="bulkWolBtn" disabled><span></span><span></span><span></span><span></span>BULK WOL</a>
          <a href="#" class="btn danger grow neon-btn" id="bulkSshBtn" disabled><span></span><span></span><span></span><span></span>SSH RUN</a>
        </div>

        <div class="sep"></div>

        <!-- Views (mobile: card lists) -->
        <section id="view-overview" class="view show">
          <div class="card">
            <div class="cardTitle">Inventory snapshot</div>
            <div class="kv">
              <div class="k">Devices</div><div class="v"><span class="pill"><span class="dot ok"></span><span id="statDevices">0</span></span></div>
              <div class="k">Online</div><div class="v"><span class="pill"><span class="dot ok"></span><span id="statOnline">0</span></span></div>
              <div class="k">Offline</div><div class="v"><span class="pill"><span class="dot bad"></span><span id="statOffline">0</span></span></div>
            </div>
            <div class="sep"></div>
            <div class="cardTitle">Job streaming</div>
            <div class="prog"><i id="jobProg"></i></div>
            <div class="monoDim" style="margin-top:8px;">Streaming results so the UI stays alive.</div>
          </div>

          <div class="card">
            <div class="cardTitle">Recent devices <span class="monoDim">Tap a device for details</span></div>
            <div class="deviceList" id="recentList"></div>
          </div>
        </section>

        <section id="view-devices" class="view">
          <div class="card">
            <div class="cardTitle">Devices <span class="monoDim">Card list (mobile)</span></div>
            <div class="deviceList" id="devicesList"></div>
          </div>
        </section>

        <section id="view-discovery" class="view">
          <div class="card">
            <div class="cardTitle">Discovery pipeline</div>
            <div class="kv">
              <div class="k">Subnet estimate</div><div class="v"><span class="pill"><span class="dot ok"></span>Interface/DHCP (SIM)</span></div>
              <div class="k">Reachability</div><div class="v"><span class="pill"><span class="dot warn"></span>ICMP/TCP sweep</span></div>
              <div class="k">ARP map</div><div class="v"><span class="pill"><span class="dot warn"></span>OS parse</span></div>
              <div class="k">mDNS</div><div class="v"><span class="pill"><span class="dot warn"></span>Names/services</span></div>
              <div class="k">SSDP</div><div class="v"><span class="pill"><span class="dot"></span>Optional</span></div>
              <div class="k">SNMP</div><div class="v"><span class="pill"><span class="dot"></span>Optional (RO)</span></div>
            </div>
            <div class="sep"></div>
            <div class="row">
              <a href="#" class="btn cyan grow neon-btn" id="inferBtn"><span></span><span></span><span></span><span></span>INFER SUBNET</a>
              <span class="monoDim" id="inferOut">Waiting…</span>
            </div>
          </div>
        </section>

        <section id="view-actions" class="view">
          <div class="card">
            <div class="cardTitle">Safe actions</div>
            <div class="row">
              <a href="#" class="btn cyan grow neon-btn" id="actPing"><span></span><span></span><span></span><span></span>PING</a>
              <a href="#" class="btn purple grow neon-btn" id="actWol"><span></span><span></span><span></span><span></span>WOL</a>
              <a href="#" class="btn grow neon-btn" id="actHttp"><span></span><span></span><span></span><span></span>HTTP</a>
              <a href="#" class="btn danger grow neon-btn" id="actSsh"><span></span><span></span><span></span><span></span>SSH</a>
              <a href="#" class="btn grow neon-btn" id="actSnmp"><span></span><span></span><span></span><span></span>SNMP (RO)</a>
            </div>
            <div class="monoDim" style="margin-top:10px;">Actions are permissioned + logged (SIM).</div>
          </div>
        </section>

        <section id="view-automation" class="view">
          <div class="card">
            <div class="cardTitle">Scheduled scans</div>
            <div class="row">
              <select class="select grow" id="schedFreq">
                <option>EVERY 5 MIN</option>
                <option selected>EVERY 15 MIN</option>
                <option>HOURLY</option>
                <option>DAILY</option>
              </select>
              <a href="#" class="btn cyan grow neon-btn" id="addSchedule"><span></span><span></span><span></span><span></span>ADD</a>
              <a href="#" class="btn grow neon-btn" id="pauseSchedules"><span></span><span></span><span></span><span></span>PAUSE</a>
            </div>
            <div class="sep"></div>
            <div id="schedules" class="monoDim">No schedules (yet).</div>
          </div>

          <div class="card">
            <div class="cardTitle">Playbooks</div>
            <div class="row">
              <input class="input grow" id="ruleMatch" placeholder="MATCH: tag:iot OR vendor:tp-link …"/>
              <select class="select grow" id="ruleAction">
                <option>PING</option>
                <option>HTTP CHECK</option>
                <option>SNMP GET</option>
              </select>
              <a href="#" class="btn purple grow neon-btn" id="addRule"><span></span><span></span><span></span><span></span>ADD RULE</a>
            </div>
            <div class="sep"></div>
            <div id="rules" class="monoDim">No rules (yet).</div>
          </div>
        </section>

        <section id="view-alerts" class="view">
          <div class="card">
            <div class="cardTitle">Alerts</div>
            <div class="monoDim">UI-ready feed. Wire engine later.</div>
            <div class="sep"></div>
            <div id="alertsList" class="monoDim">No alerts.</div>
          </div>
        </section>

        <section id="view-settings" class="view">
          <div class="card">
            <div class="cardTitle">Settings</div>
            <div class="kv">
              <div class="k">RBAC</div><div class="v"><span class="pill"><span class="dot ok"></span>Admin/Viewer</span></div>
              <div class="k">Streaming</div><div class="v" id="jobStream">OFF</div>
              <div class="k">Audit</div><div class="v">ON</div>
            </div>
          </div>
        </section>

        <section id="view-logs" class="view">
          <div class="card">
            <div class="cardTitle">Audit log</div>
            <div id="auditList" class="monoDim">No audit entries yet.</div>
          </div>
        </section>

      </div>
    </main>

    <!-- DETAILS DOCK (DESKTOP ONLY) -->
    <aside class="window purple detailsDock">
      <div class="titlebar">
        <div class="win-controls"><span></span><span></span><span></span></div>
        <div class="title">
          <h2>Device detail</h2>
          <span class="badge" id="selBadgeDock">NONE</span>
        </div>
      </div>
      <div class="dockBody" id="detailsDockBody"></div>
    </aside>

    <!-- OPS DOCK (DESKTOP ONLY) -->
    <section class="window cyan opsDock">
      <div class="titlebar">
        <div class="win-controls"><span></span><span></span><span></span></div>
        <div class="title">
          <h2>Operations</h2>
          <span class="badge" id="opsBadgeDock">READY</span>
        </div>
      </div>
      <div class="dockBody" id="opsDockBody"></div>
    </section>

  </div>

  <!-- BOTTOM NAV (MOBILE) -->
  <div class="bottomNav">
    <div class="navGrid" id="bottomNav">
      <a href="#" class="navBtn active neon-btn" data-view="overview"><span></span><span></span><span></span><span></span>Overview</a>
      <a href="#" class="navBtn neon-btn" data-view="devices"><span></span><span></span><span></span><span></span>Devices</a>
      <a href="#" class="navBtn neon-btn" data-view="actions"><span></span><span></span><span></span><span></span>Actions</a>
      <a href="#" class="navBtn neon-btn" data-view="automation"><span></span><span></span><span></span><span></span>Auto</a>
      <a href="#" class="navBtn neon-btn" data-view="discovery"><span></span><span></span><span></span><span></span>Discover</a>
      <a href="#" class="navBtn neon-btn" data-view="alerts"><span></span><span></span><span></span><span></span>Alerts</a>
      <a href="#" class="navBtn neon-btn" data-view="settings"><span></span><span></span><span></span><span></span>Settings</a>
      <a href="#" class="navBtn neon-btn" data-view="logs"><span></span><span></span><span></span><span></span>Logs</a>
    </div>
  </div>

  <!-- NAV DRAWER (MOBILE) -->
  <div class="drawerOverlay" id="navDrawer">
    <div class="window drawer cyan">
      <div class="titlebar">
        <div class="win-controls"><span></span><span></span><span></span></div>
        <div class="title">
          <h2>Navigation</h2>
          <span class="badge" id="roleBadge2">ROLE: ADMIN</span>
        </div>
      </div>
      <div style="padding:12px; display:flex; flex-direction:column; gap:12px; height: calc(100% - 44px); overflow:auto;">
        <div class="card">
          <div class="cardTitle">Quick status</div>
          <div class="kv">
            <div class="k">CIDR</div><div class="v" id="netCidr2">192.168.1.0/24</div>
            <div class="k">Gateway</div><div class="v" id="netGw2">192.168.1.1</div>
            <div class="k">Jobs</div><div class="v"><span class="pill"><span class="dot warn"></span><span id="jobsCount2">0 active</span></span></div>
          </div>
        </div>
        <div class="row">
          <a href="#" class="btn grow neon-btn" id="openOps"><span></span><span></span><span></span><span></span>OPEN OPS</a>
          <a href="#" class="btn grow neon-btn" id="closeNav"><span></span><span></span><span></span><span></span>CLOSE</a>
        </div>
        <div class="monoDim">Use bottom nav for views; drawer is for quick status + ops.</div>
      </div>
    </div>
  </div>

  <!-- DETAILS SHEET (MOBILE) -->
  <div class="sheetOverlay" id="detailSheet">
    <div class="window sheet purple">
      <div class="titlebar">
        <div class="win-controls"><span></span><span></span><span></span></div>
        <div class="title">
          <h2>Device detail</h2>
          <span class="badge" id="selBadge">NONE</span>
        </div>
      </div>
      <div style="padding:12px; height: calc(100% - 44px); overflow:auto; display:flex; flex-direction:column; gap:12px;">
        <div class="card">
          <div class="cardTitle">Selected device <span class="monoDim" id="selSub">Tap any device</span></div>
          <div class="kv" id="detailKv"></div>
        </div>

        <div class="card">
          <div class="cardTitle">Quick actions</div>
          <div class="row">
            <a href="#" class="btn cyan grow neon-btn" id="dPing" disabled><span></span><span></span><span></span><span></span>PING</a>
            <a href="#" class="btn purple grow neon-btn" id="dWol" disabled><span></span><span></span><span></span><span></span>WOL</a>
            <a href="#" class="btn grow neon-btn" id="dHttp" disabled><span></span><span></span><span></span><span></span>HTTP</a>
            <a href="#" class="btn danger grow neon-btn" id="dSsh" disabled><span></span><span></span><span></span><span></span>SSH</a>
            <a href="#" class="btn grow neon-btn" id="dSnmp" disabled><span></span><span></span><span></span><span></span>SNMP</a>
          </div>
          <div class="sep"></div>
          <div class="row">
            <input class="input grow" id="tagInput" placeholder="Add/remove tag…" disabled />
            <a href="#" class="btn grow neon-btn" id="addTag" disabled><span></span><span></span><span></span><span></span>ADD</a>
            <a href="#" class="btn danger grow neon-btn" id="removeTag" disabled><span></span><span></span><span></span><span></span>REMOVE</a>
          </div>
        </div>

        <div class="card">
          <div class="cardTitle">Live metrics (sim)</div>
          <div class="kv">
            <div class="k">RTT</div><div class="v" id="mRtt">—</div>
            <div class="k">HTTP</div><div class="v" id="mHttp">—</div>
            <div class="k">Last seen</div><div class="v" id="mSeen">—</div>
            <div class="k">Change</div><div class="v" id="mChange">—</div>
          </div>
        </div>

        <div class="row">
          <a href="#" class="btn grow neon-btn" id="closeDetail"><span></span><span></span><span></span><span></span>CLOSE</a>
        </div>
      </div>
    </div>
  </div>

  <!-- OPS SHEET (MOBILE) -->
  <div class="sheetOverlay" id="opsSheet">
    <div class="window sheet cyan">
      <div class="titlebar">
        <div class="win-controls"><span></span><span></span><span></span></div>
        <div class="title">
          <h2>Operations</h2>
          <span class="badge" id="opsBadge">READY</span>
        </div>
      </div>
      <div style="padding:12px; height: calc(100% - 44px); overflow:auto; display:flex; flex-direction:column; gap:12px;">
        <div class="terminal">
          <div class="termHead">
            <span>Mini terminal</span>
            <span class="monoDim">Simulated</span>
          </div>
          <div class="termBody" id="termBody"></div>
          <div class="termInputRow">
            <div class="termPrompt">noc$</div>
            <input class="termInput" id="termInput" placeholder="help, scan, ping 192.168.1.1 …"/>
            <a href="#" class="btn purple neon-btn" id="termSend"><span></span><span></span><span></span><span></span>SEND</a>
          </div>
        </div>

        <div class="card">
          <div class="cardTitle">Jobs + progress</div>
          <div class="kv">
            <div class="k">Active job</div><div class="v" id="jobName">none</div>
            <div class="k">Phase</div><div class="v" id="jobPhase">—</div>
            <div class="k">Found</div><div class="v" id="jobFound">0</div>
            <div class="k">Streaming</div><div class="v" id="jobStream2">OFF</div>
          </div>
          <div class="sep"></div>
          <div class="prog"><i id="jobProg2"></i></div>
          <div class="sep"></div>
          <div class="row">
            <a href="#" class="btn cyan grow neon-btn" id="jobPause"><span></span><span></span><span></span><span></span>PAUSE</a>
            <a href="#" class="btn grow neon-btn" id="jobResume"><span></span><span></span><span></span><span></span>RESUME</a>
            <a href="#" class="btn danger grow neon-btn" id="jobCancel"><span></span><span></span><span></span><span></span>CANCEL</a>
          </div>
        </div>

        <div class="row">
          <a href="#" class="btn grow neon-btn" id="closeOps"><span></span><span></span><span></span><span></span>CLOSE</a>
        </div>
      </div>
    </div>
  </div>

  <!-- SSH SHEET -->
  <div class="sheetOverlay" id="sshSheet">
    <div class="window sheet purple">
      <div class="titlebar">
        <div class="win-controls"><span></span><span></span><span></span></div>
        <div class="title">
          <h2>SSH Runner</h2>
          <span class="badge">SIM</span>
        </div>
      </div>
      <div style="padding:12px; height: calc(100% - 44px); overflow:auto; display:flex; flex-direction:column; gap:12px;">
        <div class="monoDim">No plaintext storage. This is UI wiring only.</div>
        <div class="row">
          <input class="input grow" id="sshHost" placeholder="host (ip or name)"/>
          <input class="input grow" id="sshUser" placeholder="user"/>
        </div>
        <div class="row">
          <input class="input grow" id="sshPass" placeholder="password (sim)" type="password"/>
        </div>
        <div class="row">
          <input class="input grow" id="sshCmd" placeholder="command (e.g. uname -a)"/>
        </div>
        <div class="row">
          <a href="#" class="btn danger grow neon-btn" id="sshRun"><span></span><span></span><span></span><span></span>RUN</a>
          <a href="#" class="btn grow neon-btn" id="sshClose"><span></span><span></span><span></span><span></span>CLOSE</a>
        </div>
      </div>
    </div>
  </div>

  <!-- PANIC SHEET -->
  <div class="sheetOverlay" id="panicSheet">
    <div class="window sheet cyan">
      <div class="titlebar">
        <div class="win-controls"><span></span><span></span><span></span></div>
        <div class="title">
          <h2>!_PANIC_STOP_!</h2>
          <span class="badge">JOB TERMINATION</span>
        </div>
      </div>
      <div style="padding:12px; height: calc(100% - 44px); overflow:auto; display:flex; flex-direction:column; gap:12px;">
        <div class="monoDim">Cancels active scans/actions.</div>
        <div class="row">
          <a href="#" class="btn danger grow neon-btn" id="panicConfirm"><span></span><span></span><span></span><span></span>CONFIRM STOP</a>
          <a href="#" class="btn grow neon-btn" id="panicClose"><span></span><span></span><span></span><span></span>CLOSE</a>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ==============================
    // State (SIM UI, same features)
    // ==============================
    const state = {
      view: 'overview',
      devices: [],
      selectedId: null,
      filters: new Set(),
      search: '',
      streaming: true,
      schedules: [],
      rules: [],
      audit: [],
      alerts: [],
      job: {
        active: false,
        name: 'none',
        phase: '—',
        found: 0,
        progress: 0,
        paused: false,
        timer: null
      }
    };

    const $ = (id) => document.getElementById(id);
    const now = () => new Date().toLocaleString();
    const rndInt = (min, max) => Math.floor(Math.random()*(max-min+1))+min;
    const pick = (arr) => arr[Math.floor(Math.random()*arr.length)];
    const layoutDebug = new URLSearchParams(window.location.search).get('debugLayout') === '1';

    function initLayoutDebug(){
      const hud = document.createElement('div');
      hud.className = 'layout-hud';
      document.body.appendChild(hud);

      const criticalSelectors = [
        '#scanBtn', '#openNav', '#advancedBtn', '#exportBtn', '#panicBtn',
        '#search', '#scope', '.bottomNav .navBtn'
      ];

      const labelFor = (el) => el.id || el.getAttribute('data-view') || el.textContent.trim().slice(0, 18) || el.tagName;
      const intersects = (a, b) => !(a.right <= b.left || a.left >= b.right || a.bottom <= b.top || a.top >= b.bottom);

      function checkLayout(){
        const vw = window.innerWidth;
        const vh = window.innerHeight;
        const elements = criticalSelectors
          .flatMap((sel) => Array.from(document.querySelectorAll(sel)))
          .filter((el) => el.getClientRects().length);
        const rects = elements.map((el) => ({ el, rect: el.getBoundingClientRect() }));

        const issues = [];
        rects.forEach(({ el, rect }) => {
          el.classList.remove('layout-issue', 'layout-pass');
          const label = labelFor(el);
          if (rect.left < 0 || rect.right > vw || rect.top < 0 || rect.bottom > vh){
            issues.push(`offscreen: ${label}`);
            el.classList.add('layout-issue');
          } else if (rect.width < 44 || rect.height < 44){
            issues.push(`touch<44: ${label} (${Math.round(rect.width)}x${Math.round(rect.height)})`);
            el.classList.add('layout-issue');
          } else {
            el.classList.add('layout-pass');
          }
        });

        for (let i = 0; i < rects.length; i++){
          for (let j = i + 1; j < rects.length; j++){
            if (intersects(rects[i].rect, rects[j].rect)){
              issues.push(`overlap: ${labelFor(rects[i].el)} + ${labelFor(rects[j].el)}`);
            }
          }
        }

        hud.innerHTML = `
          <div>Viewport: ${vw}x${vh}</div>
          <div>Critical controls: ${rects.length}</div>
          <div>Issues: ${issues.length}</div>
          ${issues.length ? `<div style="margin-top:6px; line-height:1.4;">${issues.slice(0, 6).join('<br/>')}</div>` : ''}
        `;
      }

      window.addEventListener('resize', () => requestAnimationFrame(checkLayout));
      setInterval(checkLayout, 500);
      checkLayout();
    }

    if (layoutDebug){
      document.body.classList.add('debug-layout');
      initLayoutDebug();
    }

    function dotForOnline(online){
      return online
        ? `<span class="pill"><span class="dot ok"></span>ONLINE</span>`
        : `<span class="pill"><span class="dot bad"></span>OFFLINE</span>`;
    }
    function formatTags(tags){
      if (!tags || !tags.length) return `<span class="monoDim">none</span>`;
      return tags.map(t => `<span class="pill"><span class="dot"></span>${t}</span>`).join(' ');
    }

    function logTerm(msg, cls='dim'){
      const el = document.createElement('div');
      el.className = `termLine ${cls}`;
      el.textContent = msg;
      $('termBody').appendChild(el);
      $('termBody').scrollTop = $('termBody').scrollHeight;
    }

    function audit(actor, action, target, result){
      state.audit.unshift({ time: now(), actor, action, target, result });
      renderAudit();
    }

    function addAlert(sev, event, device){
      state.alerts.unshift({ time: now(), sev, event, device });
      renderAlerts();
    }

    function makeDevice(i){
      const vendors = ['Apple', 'TP-Link', 'Dell', 'Samsung', 'Ubiquiti', 'Raspberry Pi', 'Google', 'Lenovo', 'Intel', 'Cisco'];
      const osGuess = ['Windows', 'Linux', 'Android', 'iOS', 'RouterOS', 'Unknown'];
      const hostBase = ['atlas','nexus','echo','titan','relay','node','vault','proxy','sensor','lumen','helios','orion'];
      const tagsPool = ['iot','server','printer','camera','laptop','phone','router','switch','nas','lab'];

      const vendor = pick(vendors);
      const os = pick(osGuess);
      const ip = `192.168.1.${rndInt(2,254)}`;
      const mac = Array.from({length:6}, () => rndInt(0,255).toString(16).padStart(2,'0')).join(':').toUpperCase();
      const hostname = `${pick(hostBase)}-${rndInt(10,99)}`;
      const online = Math.random() > 0.22;

      const ports = pick(['22,80,443','80,443','53,67,68','445,3389','1900,5000','631','—']);
      const services = ports === '—' ? '—' : pick(['ssh,http,https','http,https','dns,dhcp','smb,rdp','ssdp,dlna','ipp']);
      const names = pick(['mDNS: _http._tcp', 'mDNS: _ssh._tcp', 'SSDP: MediaRenderer', 'mDNS: — / SSDP: —', 'mDNS: _workstation._tcp']);
      const ipHistory = [ip, `192.168.1.${rndInt(2,254)}`, `192.168.1.${rndInt(2,254)}`].slice(0, rndInt(1,3));

      const tags = [];
      if (Math.random() > 0.55) tags.push(pick(tagsPool));
      if (Math.random() > 0.78) tags.push(pick(tagsPool.filter(x => !tags.includes(x))));

      return {
        id: `d_${Date.now()}_${i}_${Math.random().toString(16).slice(2)}`,
        online, hostname, ip, ipHistory, mac, vendor, os, ports, services, names, tags,
        lastSeen: now(),
        changeScore: rndInt(0, 100)
      };
    }

    function filteredDevices(){
      const q = state.search.trim().toLowerCase();
      let list = [...state.devices];

      if (q){
        list = list.filter(d => {
          const hay = [d.hostname,d.ip,d.mac,d.vendor,d.os,d.tags.join(','),d.services,d.ports,d.names].join(' ').toLowerCase();
          return hay.includes(q);
        });
      }

      for (const f of state.filters){
        if (f === 'online') list = list.filter(d => d.online);
        else if (f === 'offline') list = list.filter(d => !d.online);
        else if (f.startsWith('os:')){
          const os = f.split(':')[1];
          list = list.filter(d => d.os.toLowerCase() === os);
        } else if (f.startsWith('tag:')){
          const t = f.split(':')[1];
          list = list.filter(d => d.tags.includes(t));
        }
      }
      return list;
    }

    // ==============================
    // Views
    // ==============================
    function setView(view){
      state.view = view;
      $('mainTitle').textContent = view.charAt(0).toUpperCase() + view.slice(1);

      document.querySelectorAll('.view').forEach(v => v.classList.remove('show'));
      $(`view-${view}`).classList.add('show');

      document.querySelectorAll('.navBtn').forEach(b => b.classList.toggle('active', b.dataset.view === view));
    }

    function renderDeviceCard(d, withCheckbox){
      const checked = '';
      return `
        <div class="devCard" data-id="${d.id}">
          <div class="devTop">
            <div class="devName">${d.hostname}</div>
            ${dotForOnline(d.online)}
          </div>
          <div class="devMeta">
            <span class="pill"><span class="dot warn"></span>${d.ip}</span>
            <span class="pill"><span class="dot"></span>${d.vendor}</span>
            <span class="pill"><span class="dot"></span>${d.os}</span>
          </div>
          <div class="sep"></div>
          <div class="monoDim" style="word-break:break-word;">
            MAC: ${d.mac}<br/>
            Ports: ${d.ports} · Services: ${d.services}<br/>
            Names: ${d.names}<br/>
            Tags: ${d.tags.length ? d.tags.join(', ') : 'none'}
          </div>
        </div>
      `;
    }

    function wireCardClicks(container){
      container.querySelectorAll('[data-id]').forEach(el => {
        el.addEventListener('click', () => {
          state.selectedId = el.dataset.id;
          renderDetail();
          openDetail();
        });
      });
    }

    function renderOverview(){
      const list = filteredDevices().slice(0, 8);
      const total = state.devices.length;
      const online = state.devices.filter(d => d.online).length;
      const offline = total - online;

      $('statDevices').textContent = total;
      $('statOnline').textContent = online;
      $('statOffline').textContent = offline;

      $('recentList').innerHTML = list.length
        ? list.map(d => renderDeviceCard(d)).join('')
        : `<div class="monoDim">No devices yet. Tap SCAN.</div>`;

      wireCardClicks($('recentList'));
    }

    function renderDevices(){
      const list = filteredDevices();
      $('devicesList').innerHTML = list.length
        ? list.map(d => renderDeviceCard(d)).join('')
        : `<div class="monoDim">No devices. Scan the network.</div>`;

      wireCardClicks($('devicesList'));
    }

    function renderJob(){
      $('jobName').textContent = state.job.name;
      $('jobPhase').textContent = state.job.phase;
      $('jobFound').textContent = String(state.job.found);

      $('jobProg').style.width = `${state.job.progress}%`;
      $('jobProg2').style.width = `${state.job.progress}%`;

      $('jobStream').textContent = state.streaming ? 'ON' : 'OFF';
      $('jobStream2').textContent = state.streaming ? 'ON' : 'OFF';

      $('wsBadge').textContent = state.job.active ? 'WS: STREAMING' : 'WS: IDLE';
      $('opsBadge').textContent = state.job.active ? (state.job.paused ? 'PAUSED' : 'RUNNING') : 'READY';
      $('streamBadge').textContent = `STREAM: ${state.streaming ? 'ON' : 'OFF'}`;

      // drawer quick status too
      if ($('jobsCount2')) $('jobsCount2').textContent = state.job.active ? '1 active' : '0 active';
      if ($('jobsCount')) $('jobsCount').textContent = state.job.active ? '1 active' : '0 active';
    }

    function renderSchedules(){
      $('schedules').innerHTML = state.schedules.length
        ? state.schedules.map((s,i)=>`[${i+1}] ${s}`).join('<br/>')
        : 'No schedules (yet).';
    }

    function renderRules(){
      $('rules').innerHTML = state.rules.length
        ? state.rules.map((r,i)=>`[${i+1}] WHEN ${r.match} → DO ${r.action}`).join('<br/>')
        : 'No rules (yet).';
    }

    function renderAudit(){
      $('auditList').innerHTML = state.audit.length
        ? state.audit.slice(0, 60).map(a => `• ${a.time} · ${a.actor} · ${a.action} · ${a.target} · ${a.result}`).join('<br/>')
        : 'No audit entries yet.';
    }

    function renderAlerts(){
      $('alertsList').innerHTML = state.alerts.length
        ? state.alerts.slice(0, 40).map(a => `• ${a.time} · ${a.sev} · ${a.event} · ${a.device}`).join('<br/>')
        : 'No alerts.';
    }

    function renderDetail(){
      const d = state.devices.find(x => x.id === state.selectedId);
      const enable = !!d;

      $('selBadge').textContent = d ? `SELECTED: ${d.hostname}` : 'NONE';
      $('selSub').textContent = d ? `${d.ip} • ${d.vendor} • ${d.os}` : 'Tap any device';

      ['dPing','dWol','dHttp','dSsh','dSnmp','tagInput','addTag','removeTag'].forEach(id => $(id).disabled = !enable);

      if (!d){
        $('detailKv').innerHTML = `
          <div class="k">Hostname</div><div class="v">—</div>
          <div class="k">IP</div><div class="v">—</div>
          <div class="k">MAC</div><div class="v">—</div>
          <div class="k">Vendor</div><div class="v">—</div>
          <div class="k">OS</div><div class="v">—</div>
          <div class="k">Names</div><div class="v">—</div>
          <div class="k">Ports</div><div class="v">—</div>
          <div class="k">Services</div><div class="v">—</div>
          <div class="k">Tags</div><div class="v">—</div>
        `;
        $('mRtt').textContent = '—';
        $('mHttp').textContent = '—';
        $('mSeen').textContent = '—';
        $('mChange').textContent = '—';
        return;
      }

      $('detailKv').innerHTML = `
        <div class="k">Hostname</div><div class="v">${d.hostname}</div>
        <div class="k">IP</div><div class="v">${d.ip}</div>
        <div class="k">MAC</div><div class="v">${d.mac}</div>
        <div class="k">Vendor</div><div class="v">${d.vendor}</div>
        <div class="k">OS</div><div class="v">${d.os}</div>
        <div class="k">Names</div><div class="v">${d.names}</div>
        <div class="k">Ports</div><div class="v">${d.ports}</div>
        <div class="k">Services</div><div class="v">${d.services}</div>
        <div class="k">IP hist</div><div class="v">${d.ipHistory.join(', ')}</div>
        <div class="k">Tags</div><div class="v">${d.tags.length ? d.tags.join(', ') : 'none'}</div>
      `;

      $('mRtt').textContent = d.online ? `${rndInt(2,45)} ms` : 'timeout';
      $('mHttp').textContent = d.online ? (Math.random()>0.25 ? '200 OK' : '503') : 'n/a';
      $('mSeen').textContent = d.lastSeen;
      $('mChange').textContent = `${d.changeScore}/100`;
    }

    function renderAll(){
      renderOverview();
      renderDevices();
      renderSchedules();
      renderRules();
      renderAudit();
      renderAlerts();
      renderJob();
      renderDetail();
    }

    // ==============================
    // Drawers / sheets
    // ==============================
    function openNav(){ $('navDrawer').classList.add('show'); }
    function closeNav(){ $('navDrawer').classList.remove('show'); }

    function openDetail(){ $('detailSheet').classList.add('show'); }
    function closeDetail(){ $('detailSheet').classList.remove('show'); }

    function openOps(){ $('opsSheet').classList.add('show'); }
    function closeOps(){ $('opsSheet').classList.remove('show'); }

    function openSSH(){ $('sshSheet').classList.add('show'); }
    function closeSSH(){ $('sshSheet').classList.remove('show'); }

    function openPanic(){ $('panicSheet').classList.add('show'); }
    function closePanic(){ $('panicSheet').classList.remove('show'); }

    // ==============================
    // Scan job (sim streaming)
    // ==============================
    function mapApiDevice(d, idx){
      const ip = d.ip || d.id || `unknown-${idx}`;
      return {
        id: d.id || `api_${idx}_${ip}`,
        online: d.online !== false,
        hostname: d.id || ip,
        ip,
        ipHistory: [ip],
        mac: '—',
        vendor: 'Unknown',
        os: 'Unknown',
        ports: '—',
        services: '—',
        names: '—',
        tags: [],
        lastSeen: d.lastSeen ? new Date(d.lastSeen).toLocaleString() : now(),
        changeScore: 0
      };
    }

    async function runRealScan(label){
      try {
        logTerm(`[${now()}] Requesting engine scan...`, 'dim');
        const res = await fetch('/api/v1/discovery/scan', { method: 'POST' });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const payload = await res.json();
        if (!Array.isArray(payload)) throw new Error('bad payload');

        state.devices = payload.map(mapApiDevice);
        state.job.found = state.devices.length;
        state.job.progress = 100;
        state.job.phase = 'Complete';
        state.job.active = false;
        state.job.paused = false;

        $('healthLight').className = 'statusLight ok';
        $('healthText').textContent = 'ENGINE: IDLE';
        $('buildBadge').textContent = 'ENGINE: CONNECTED';
        $('wsBadge').textContent = 'WS: HTTP';

        audit('admin','SCAN_END', label, `OK (${state.job.found} devices)`);
        logTerm(`[${now()}] Scan complete. Found ${state.job.found} devices.`, 'ok');
        renderAll();
        return true;
      } catch (err) {
        logTerm(`[${now()}] Real scan failed (${err.message}). Falling back to SIM.`, 'warn');
        return false;
      }
    }

    function startSimScan(label){
      const phases = ['Subnet estimate','Reachability sweep','ARP parse','mDNS browse','SSDP probe','Optional SNMP','Finalize'];
      let tick = 0;

      state.job.timer = setInterval(() => {
        if (!state.job.active) return;
        if (state.job.paused) return;

        tick++;
        const p = Math.min(100, Math.floor((tick / 30) * 100));
        state.job.progress = p;

        const idx = Math.min(phases.length - 1, Math.floor((p / 100) * phases.length));
        state.job.phase = phases[idx];

        if (tick % 2 === 0 && state.devices.length < 40){
          const newDev = makeDevice(tick);
          state.devices.unshift(newDev);
          state.job.found++;
          logTerm(`[${now()}] + discovered ${newDev.ip} (${newDev.hostname}) [${newDev.vendor}, ${newDev.os}]`, 'dim');

          if (state.streaming){
            renderOverview();
            if (state.view === 'devices') renderDevices();
          }

          if (Math.random() > 0.92){
            addAlert('WARN','DEVICE_CHANGED', `${newDev.hostname} (${newDev.ip})`);
          }
        }

        if (tick % 7 === 0 && state.devices.length){
          const d = pick(state.devices);
          d.online = Math.random() > 0.30;
          d.lastSeen = now();
        }

        renderJob();

        if (p >= 100){
          clearInterval(state.job.timer);
          state.job.timer = null;
          state.job.active = false;
          state.job.phase = 'Complete';
          audit('admin','SCAN_END', label, `OK (${state.job.found} devices)`);
          logTerm(`[${now()}] Scan complete. Found ${state.job.found} devices.`, 'ok');
          $('healthText').textContent = 'ENGINE: IDLE';
          renderAll();
        }
      }, 180);
    }

    function startScan(label){
      if (state.job.active){
        logTerm(`[${now()}] Scan denied: job already active.`, 'warn');
        return;
      }

      state.job.active = true;
      state.job.paused = false;
      state.job.name = label;
      state.job.phase = 'Subnet estimate';
      state.job.found = 0;
      state.job.progress = 0;

      $('healthLight').className = 'statusLight ok';
      $('healthText').textContent = 'ENGINE: RUNNING JOB';

      audit('admin','SCAN_START', label, 'OK');
      logTerm(`[${now()}] Starting scan: ${label}`, 'ok');
      renderJob();

      runRealScan(label).then((ok) => {
        if (!ok) startSimScan(label);
      });
    }

    function cancelJob(reason){
      if (!state.job.active) return;
      clearInterval(state.job.timer);
      state.job.timer = null;
      state.job.active = false;
      state.job.phase = 'Cancelled';
      audit('admin','JOB_CANCEL', state.job.name, reason);
      logTerm(`[${now()}] Job cancelled: ${reason}`, 'bad');
      renderJob();
    }

    // ==============================
    // Actions (sim)
    // ==============================
    function actOnDevice(action, d){
      if (!d) return;
      const tgt = `${d.hostname} (${d.ip})`;
      audit('admin', action, tgt, 'OK (SIM)');
      logTerm(`[${now()}] ACTION ${action} → ${tgt}`, 'ok');

      if (action === 'PING'){
        logTerm(`PING ${d.ip}: time=${d.online ? rndInt(2,45)+'ms' : 'timeout'} ttl=${d.online ? rndInt(50,128) : '-'}`, d.online ? 'ok' : 'warn');
      } else if (action === 'WOL'){
        logTerm(`WOL magic packet sent to ${d.mac}`, 'ok');
      } else if (action === 'HTTP'){
        logTerm(`HTTP GET http://${d.ip}/ => ${d.online ? pick(['200 OK','301','401','503']) : 'n/a'}`, d.online ? 'dim' : 'warn');
      } else if (action === 'SNMP'){
        logTerm(`SNMP GET sysUpTime.0 => ${d.online ? rndInt(1000,999999)+' ticks' : 'timeout'}`, d.online ? 'dim' : 'warn');
      }
    }

    // ==============================
    // Terminal
    // ==============================
    function termExec(){
      const raw = $('termInput').value.trim();
      if (!raw) return;
      $('termInput').value = '';
      logTerm(`noc$ ${raw}`, 'dim');

      const [cmd, ...args] = raw.split(/\s+/);
      const a = args.join(' ');

      if (cmd === 'help'){
        logTerm(`Commands: help | scan | ping <ip> | wol <mac> | select <hostname> | export | clear`, 'ok');
        return;
      }
      if (cmd === 'clear'){
        $('termBody').innerHTML = '';
        return;
      }
      if (cmd === 'scan'){
        startScan('TERM_SCAN');
        return;
      }
      if (cmd === 'export'){
        audit('admin','EXPORT','device_inventory','OK (SIM)');
        logTerm(`[${now()}] Export requested (SIM).`, 'dim');
        return;
      }
      if (cmd === 'ping'){
        const ip = args[0];
        if (!ip) return logTerm('usage: ping <ip>', 'warn');
        logTerm(`PING ${ip}: time=${rndInt(2,45)}ms ttl=${rndInt(50,128)}`, 'ok');
        return;
      }
      if (cmd === 'wol'){
        const mac = args[0];
        if (!mac) return logTerm('usage: wol <mac>', 'warn');
        logTerm(`WOL magic packet sent to ${mac}`, 'ok');
        return;
      }
      if (cmd === 'select'){
        const name = a.toLowerCase();
        const d = state.devices.find(x => x.hostname.toLowerCase() === name);
        if (!d) return logTerm(`No device named "${a}".`, 'warn');
        state.selectedId = d.id;
        renderDetail();
        openDetail();
        logTerm(`Selected: ${d.hostname} (${d.ip})`, 'ok');
        return;
      }

      logTerm(`Unknown command: ${cmd} (type help)`, 'warn');
    }

    // ==============================
    // Wiring
    // ==============================
    function wireUI(){
      // top controls
      $('openNav').addEventListener('click', openNav);
      $('closeNav').addEventListener('click', closeNav);

      $('openOps').addEventListener('click', () => { closeNav(); openOps(); });
      $('closeOps').addEventListener('click', closeOps);

      $('closeDetail').addEventListener('click', closeDetail);

      $('scanBtn').addEventListener('click', () => startScan('SCAN_LAN_FAST'));

      $('advancedBtn').addEventListener('click', () => {
        const m = $('advancedMenu');
        m.style.display = (m.style.display === 'none' || !m.style.display) ? 'block' : 'none';
      });
      $('closeAdvanced').addEventListener('click', () => $('advancedMenu').style.display = 'none');
      $('runAdvanced').addEventListener('click', () => {
        $('advancedMenu').style.display = 'none';
        $('netCidr2').textContent = $('cidr').value;
        startScan(`ADVANCED_${$('scanMode').value.toUpperCase()} ${$('cidr').value}`);
      });

      $('exportBtn').addEventListener('click', () => {
        audit('admin','EXPORT','device_inventory','OK (SIM)');
        logTerm(`[${now()}] Export requested (SIM).`, 'dim');
      });

      $('panicBtn').addEventListener('click', openPanic);
      $('panicClose').addEventListener('click', closePanic);
      $('panicConfirm').addEventListener('click', () => { closePanic(); cancelJob('PANIC_STOP'); });

      // search + scope
      $('search').addEventListener('input', (e) => { state.search = e.target.value; renderAll(); });
      $('scope').addEventListener('change', (e) => {
        audit('admin','SCOPE_SET','scan', e.target.value.toUpperCase());
        logTerm(`[${now()}] Scope set to ${e.target.value.toUpperCase()}.`, 'dim');
      });

      // chips
      $('chips').addEventListener('click', (e) => {
        const chip = e.target.closest('.chip');
        if (!chip) return;
        const key = chip.dataset.chip;
        if (chip.classList.contains('on')){
          chip.classList.remove('on');
          state.filters.delete(key);
        } else {
          chip.classList.add('on');
          state.filters.add(key);
        }
        renderAll();
      });

      // bottom nav
      $('bottomNav').addEventListener('click', (e) => {
        const b = e.target.closest('.navBtn');
        if (!b) return;
        setView(b.dataset.view);
        renderAll();
      });

      // discovery
      $('inferBtn').addEventListener('click', () => {
        $('inferOut').textContent = `Inferred: ${$('netCidr2').textContent} via DHCP`;
        audit('admin','SUBNET_INFER', $('netCidr2').textContent, 'OK (SIM)');
        logTerm(`[${now()}] Subnet inference complete.`, 'ok');
      });

      // actions view buttons (operate on selected)
      $('actPing').addEventListener('click', () => actOnDevice('PING', state.devices.find(d=>d.id===state.selectedId)));
      $('actWol').addEventListener('click', () => actOnDevice('WOL', state.devices.find(d=>d.id===state.selectedId)));
      $('actHttp').addEventListener('click', () => actOnDevice('HTTP', state.devices.find(d=>d.id===state.selectedId)));
      $('actSnmp').addEventListener('click', () => actOnDevice('SNMP', state.devices.find(d=>d.id===state.selectedId)));
      $('actSsh').addEventListener('click', () => {
        const d = state.devices.find(x => x.id === state.selectedId);
        if (!d) return;
        $('sshHost').value = d.ip;
        $('sshUser').value = '';
        $('sshPass').value = '';
        $('sshCmd').value = '';
        openSSH();
      });

      // detail actions
      $('dPing').addEventListener('click', () => actOnDevice('PING', state.devices.find(d=>d.id===state.selectedId)));
      $('dWol').addEventListener('click', () => actOnDevice('WOL', state.devices.find(d=>d.id===state.selectedId)));
      $('dHttp').addEventListener('click', () => actOnDevice('HTTP', state.devices.find(d=>d.id===state.selectedId)));
      $('dSnmp').addEventListener('click', () => actOnDevice('SNMP', state.devices.find(d=>d.id===state.selectedId)));
      $('dSsh').addEventListener('click', () => {
        const d = state.devices.find(x => x.id === state.selectedId);
        if (!d) return;
        $('sshHost').value = d.ip;
        $('sshUser').value = '';
        $('sshPass').value = '';
        $('sshCmd').value = '';
        openSSH();
      });

      // tagging
      $('addTag').addEventListener('click', () => {
        const d = state.devices.find(x => x.id === state.selectedId);
        const tag = $('tagInput').value.trim().toLowerCase();
        if (!d || !tag) return;
        if (!d.tags.includes(tag)) d.tags.push(tag);
        $('tagInput').value = '';
        audit('admin','TAG_ADD', `${d.hostname} (${d.ip})`, tag);
        renderAll();
      });
      $('removeTag').addEventListener('click', () => {
        const d = state.devices.find(x => x.id === state.selectedId);
        const tag = $('tagInput').value.trim().toLowerCase();
        if (!d || !tag) return;
        d.tags = d.tags.filter(t => t !== tag);
        $('tagInput').value = '';
        audit('admin','TAG_REMOVE', `${d.hostname} (${d.ip})`, tag);
        renderAll();
      });

      // bulk (mobile version: acts on "recently selected" only, until you wire true multi-select UI)
      $('bulkPingBtn').addEventListener('click', () => {
        const d = state.devices.find(x => x.id === state.selectedId);
        if (!d) return;
        audit('admin','BULK_PING','(selected only on mobile UI)', 'OK (SIM)');
        actOnDevice('PING', d);
      });
      $('bulkWolBtn').addEventListener('click', () => {
        const d = state.devices.find(x => x.id === state.selectedId);
        if (!d) return;
        audit('admin','BULK_WOL','(selected only on mobile UI)', 'OK (SIM)');
        actOnDevice('WOL', d);
      });
      $('bulkSshBtn').addEventListener('click', () => {
        const d = state.devices.find(x => x.id === state.selectedId);
        if (!d) return;
        $('sshHost').value = d.ip;
        $('sshUser').value = '';
        $('sshPass').value = '';
        $('sshCmd').value = '';
        audit('admin','BULK_SSH','(selected only on mobile UI)', 'OPEN_SSH');
        openSSH();
      });

      // SSH sheet
      $('sshClose').addEventListener('click', closeSSH);
      $('sshRun').addEventListener('click', () => {
        const host = $('sshHost').value.trim();
        const user = $('sshUser').value.trim() || 'user';
        const cmd = $('sshCmd').value.trim() || 'echo hello';
        closeSSH();
        audit('admin','SSH_RUN', host || '(target)', 'OK (SIM)');
        logTerm(`[${now()}] SSH ${user}@${host}: ${cmd}`, 'ok');
        logTerm(`stdout: ${pick(['ok','done','permission denied (lol)','service active','Linux x86_64'])}`, 'dim');
      });

      // ops job controls
      $('jobPause').addEventListener('click', () => {
        if (!state.job.active) return;
        state.job.paused = true;
        audit('admin','JOB_PAUSE', state.job.name, 'OK');
        logTerm(`[${now()}] Job paused.`, 'warn');
        renderJob();
      });
      $('jobResume').addEventListener('click', () => {
        if (!state.job.active) return;
        state.job.paused = false;
        audit('admin','JOB_RESUME', state.job.name, 'OK');
        logTerm(`[${now()}] Job resumed.`, 'ok');
        renderJob();
      });
      $('jobCancel').addEventListener('click', () => cancelJob('USER_CANCEL'));

      // terminal
      $('termSend').addEventListener('click', termExec);
      $('termInput').addEventListener('keydown', (e) => { if (e.key === 'Enter') termExec(); });

      // schedules/rules
      $('addSchedule').addEventListener('click', () => {
        const s = $('schedFreq').value;
        state.schedules.push(`SCAN ${$('netCidr2').textContent} @ ${s}`);
        audit('admin','SCHEDULE_ADD','scan', s);
        renderSchedules();
      });
      $('pauseSchedules').addEventListener('click', () => {
        audit('admin','SCHEDULE_PAUSE_ALL','scan', 'OK (SIM)');
        logTerm(`[${now()}] Schedules paused (SIM).`, 'warn');
      });
      $('addRule').addEventListener('click', () => {
        const match = $('ruleMatch').value.trim();
        const action = $('ruleAction').value;
        if (!match) return;
        state.rules.push({ match, action });
        $('ruleMatch').value = '';
        audit('admin','RULE_ADD', match, action);
        renderRules();
      });

      // close overlays by tapping backdrop
      $('navDrawer').addEventListener('click', (e) => { if (e.target === $('navDrawer')) closeNav(); });
      $('detailSheet').addEventListener('click', (e) => { if (e.target === $('detailSheet')) closeDetail(); });
      $('opsSheet').addEventListener('click', (e) => { if (e.target === $('opsSheet')) closeOps(); });
      $('sshSheet').addEventListener('click', (e) => { if (e.target === $('sshSheet')) closeSSH(); });
      $('panicSheet').addEventListener('click', (e) => { if (e.target === $('panicSheet')) closePanic(); });
    }

    function updateBulkEnabled(){
      const enabled = !!state.selectedId;
      $('tagBtn').disabled = !enabled;
      $('bulkPingBtn').disabled = !enabled;
      $('bulkWolBtn').disabled = !enabled;
      $('bulkSshBtn').disabled = !enabled;
    }

    function bootstrap(){
      $('healthLight').className = 'statusLight warn';
      $('healthText').textContent = 'ENGINE: STARTUP (SIM)';
      $('buildBadge').textContent = 'ENGINE: CONNECTING';

      setTimeout(() => {
        $('healthLight').className = 'statusLight ok';
        $('healthText').textContent = 'ENGINE: CONNECTED (SIM)';
        $('buildBadge').textContent = 'ENGINE: CONNECTED';
        logTerm(`[${now()}] NEON-NOC initialized. Type "help".`, 'ok');
      }, 650);

      // init quick status duplicates
      $('netCidr2').textContent = '192.168.1.0/24';
      $('netGw2').textContent = '192.168.1.1';

      renderAll();
      updateBulkEnabled();
    }

    // When selection changes, enable bulk + tag tools
    const _renderDetail = renderDetail;
    renderDetail = function(){
      _renderDetail();
      updateBulkEnabled();
    };

    wireUI();
    bootstrap();
  </script>
</div>

<!-- Hidden stubs required by neon_dash.js (task/sub UI) to avoid null errors -->
<div style="display:none">
  <form id="add-task-form"><input id="task-title-input"/><select id="task-category-input"></select></form>
  <div id="task-list"></div>
  <form id="add-sub-form"><input id="sub-name-input"/><input id="sub-price-input"/></form>
  <div id="subscription-list"></div>
  <div id="subscription-total"></div>
  <div id="time"></div>
  <div id="date"></div>
</div>

</body>
</html>
