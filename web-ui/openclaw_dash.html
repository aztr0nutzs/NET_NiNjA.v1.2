<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OpenClaw Android Companion ‚Äî Android Dashboard (Redline Shell)</title>
  <style>
    :root {
      --bg: #000;
      --panel: #070707;
      --panel2: #0b0b0b;
      --text: #ffe9e9;
      --muted: #b89797;
      --line: rgba(255, 70, 70, 0.18);
      --red: #ff2f4d;
      --red2: #ff6b6b;
      --red3: #a10023;
      --good: #77ff9b;
      --radius: 16px;
      --shadow: 0 0 24px rgba(255, 47, 77, 0.18), inset 0 0 0 1px rgba(255,255,255,0.04);
    }

    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:#000;color:var(--text);font-family:Inter,Segoe UI,Roboto,system-ui,sans-serif;overflow:hidden}

    body::before{
      content:"";position:fixed;inset:0;pointer-events:none;
      background:
        radial-gradient(50rem 45rem at -5% 15%, rgba(255,47,77,.06), transparent 60%),
        radial-gradient(40rem 40rem at 110% 0%, rgba(161,0,35,.05), transparent 60%),
        radial-gradient(30rem 30rem at 70% 100%, rgba(255,107,107,.10), transparent 65%),
        repeating-linear-gradient(to bottom, rgba(255,255,255,.02) 0 1px, transparent 1px 4px);
    }

    .app{height:100vh;display:grid;grid-template-columns:300px 1fr;gap:12px;padding:12px}

    .glass{background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));border:1px solid rgba(255,255,255,.08);border-radius:var(--radius);box-shadow:var(--shadow);backdrop-filter:blur(8px)}

    .sidebar{padding:12px;display:flex;flex-direction:column;min-height:0}
    .brand{display:grid;grid-template-columns:68px 1fr;gap:10px;align-items:center;border-bottom:1px dashed var(--line);padding-bottom:10px;margin-bottom:10px}

    .avatar{width:68px;height:68px;border-radius:14px;background:#000;border:1px solid rgba(255,47,77,.22);display:grid;place-items:center;position:relative;overflow:hidden}
    .avatar svg{width:60px;height:60px;filter:drop-shadow(0 0 9px rgba(255,47,77,.5));animation:botFloat 2.6s ease-in-out infinite, botTilt 1.6s ease-in-out infinite alternate}
    .avatar::before{content:"";position:absolute;inset:-40% -130%;background:linear-gradient(90deg, transparent, rgba(255,47,77,.35), transparent);animation:sweep 2.4s linear infinite}
    .avatar::after{content:"";position:absolute;inset:0;background:radial-gradient(circle at 30% 25%, rgba(255,255,255,.16), transparent 40%);pointer-events:none}

    .eye{animation:blink 4.5s infinite}
    @keyframes blink{0%,42%,44%,100%{opacity:1}43%{opacity:.05}}
    @keyframes botFloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-3px)}}
    @keyframes botTilt{from{transform:rotate(-2deg)}to{transform:rotate(2deg)}}
    @keyframes sweep{to{transform:translateX(200%)}}

    .brand h1{margin:0;font-size:15px}
    .brand p{margin:2px 0 0;color:var(--muted);font-size:12px}

    .menu{overflow:auto;display:grid;gap:8px;padding-right:4px}
    .menu-item{position:relative;overflow:hidden;border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:10px 12px;background:rgba(255,255,255,.02);color:var(--text);text-align:left;cursor:pointer;font-size:13px;transition:.2s}
    .menu-item::before{content:"";position:absolute;inset:0;background:linear-gradient(90deg, rgba(255,47,77,.06), rgba(161,0,35,.18));opacity:0;transition:.2s}
    .menu-item:hover{transform:translateX(3px);border-color:rgba(255,47,77,.22)}
    .menu-item.active{border-color:rgba(255,47,77,.35);box-shadow:0 0 18px rgba(255,47,77,.10) inset}
    .menu-item.active::before{opacity:1}

    .main{display:grid;grid-template-rows:auto auto 1fr;gap:10px;min-height:0}
    .topbar{padding:12px 14px;display:grid;grid-template-columns:1fr auto;align-items:center;gap:8px}
    .status{display:flex;align-items:center;gap:8px;color:var(--muted);font-size:13px}
    .dot{width:10px;height:10px;border-radius:50%;background:var(--good);box-shadow:0 0 10px var(--good);animation:pulse 1.8s infinite}
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.4);opacity:.4}}

    .toolbar{display:flex;gap:8px}
    .btn{border:1px solid rgba(255,47,77,.42);background:linear-gradient(130deg, rgba(255,47,77,.2), rgba(161,0,35,.22));color:var(--text);border-radius:10px;padding:8px 12px;font-size:12px;cursor:pointer}

    .content{min-height:0;overflow:auto;padding:10px;display:grid;gap:12px;grid-template-columns:repeat(12,1fr)}
    .card{grid-column:span 4;min-height:120px;padding:14px;position:relative;overflow:hidden}
    .wide{grid-column:span 8}.full{grid-column:1/-1}

    .card::after{content:"";position:absolute;inset:auto -35% -65% -35%;height:120px;background:radial-gradient(circle, rgba(255,47,77,.2), transparent 70%);pointer-events:none}
    .card h3{margin:0 0 8px;font-size:14px}.kpi{font-size:30px;font-weight:700}.muted{font-size:12px;color:var(--muted)}

    .chart{height:210px;border-radius:12px;border:1px dashed rgba(255,255,255,.12);overflow:hidden;background:linear-gradient(to top, rgba(255,47,77,.08), transparent), repeating-linear-gradient(to right, rgba(255,255,255,.03) 0 1px, transparent 1px 24px), repeating-linear-gradient(to top, rgba(255,255,255,.02) 0 1px, transparent 1px 24px)}

    .log{background:#020202;border:1px solid rgba(255,255,255,.08);border-radius:10px;padding:10px;height:220px;overflow:auto;font-family:Cascadia Code,Consolas,monospace;font-size:12px;line-height:1.45}
    .tag{display:inline-flex;border:1px solid rgba(255,255,255,.2);border-radius:999px;padding:4px 8px;font-size:11px;color:var(--muted);margin-right:6px}

    .grid-two{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .settings-row{display:flex;justify-content:space-between;align-items:center;gap:12px;padding:10px 0;border-bottom:1px dashed rgba(255,255,255,.08);font-size:13px}
    .switch{width:42px;height:24px;border-radius:999px;border:1px solid rgba(255,255,255,.2);background:#111;position:relative;cursor:pointer}
    .switch::after{content:"";position:absolute;top:2px;left:2px;width:18px;height:18px;border-radius:50%;background:#666;transition:.2s}
    .switch.on{border-color:rgba(255,47,77,.7);box-shadow:0 0 12px rgba(255,47,77,.25) inset}
    .switch.on::after{left:20px;background:var(--red);box-shadow:0 0 9px var(--red)}

    
    /* ===== Chat Interface (ported into Redline shell) ===== */
    .chat-wrap{display:flex;flex-direction:column;gap:10px;min-height:520px}
    .chat-log{flex:1;min-height:280px;max-height:520px;overflow:auto;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:linear-gradient(180deg, rgba(0,0,0,.65), rgba(0,0,0,.9))}
    .bubble{max-width:82%;padding:10px 12px;border-radius:14px;border:1px solid rgba(255,255,255,.10);margin:8px 0;font-size:13px;line-height:1.35}
    .bubble.user{margin-left:auto;background:linear-gradient(135deg, rgba(255,47,77,.08), rgba(161,0,35,.18));border-color:rgba(255,47,77,.35)}
    .bubble.bot{margin-right:auto;background:rgba(255,255,255,.03);border-color:rgba(255,255,255,.10)}
    .bubble .meta{display:block;margin-top:6px;color:var(--muted);font-size:11px}
    .chat-input{display:grid;grid-template-columns:1fr auto;gap:8px;align-items:center}
    .chat-input textarea{resize:none;height:44px;max-height:120px;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.10);background:#050505;color:var(--text);outline:none;font-family:inherit;font-size:13px}
    .chat-input textarea:focus{border-color:rgba(255,47,77,.55);box-shadow:0 0 0 3px rgba(255,47,77,.12)}
    .chat-actions{display:flex;gap:8px}
    .btn.secondary{border-color:rgba(255,255,255,.14);background:rgba(255,255,255,.03)}


    @media (max-width:1200px){
      .app{
        grid-template-columns:1fr;
        grid-template-rows:auto minmax(0,1fr);
        height:100dvh;
      }
      .sidebar{
        max-height:none;
        overflow:auto;
      }
      .main{min-height:0}
      .content{min-height:0}
      .card,.wide{grid-column:1/-1}
    }
  
    /* --- Added to ensure menu/chat always visible even if other scripts fail --- */
    .hidden{display:none !important}
    .panel{padding:14px;grid-column:1/-1}
    .muted{color:var(--muted)}
    .menu .menu-item{width:100%;display:flex;gap:10px;align-items:center;text-align:left}
    .menu .menu-item .mi-icon{width:20px;display:inline-flex;justify-content:center;opacity:.9}
    .btn.primary{border-color:rgba(255,47,77,.5);box-shadow:0 0 0 1px rgba(255,47,77,.2) inset}
    .chat{display:flex;flex-direction:column;gap:10px;min-height:60vh}
    .chat-header{display:flex;align-items:flex-start;justify-content:space-between;gap:12px}
    .chat-log{flex:1;min-height:260px;max-height:60vh;overflow:auto;padding:10px;border:1px solid rgba(255,255,255,.08);border-radius:14px;background:rgba(0,0,0,.35)}
    .msg{display:flex;margin:6px 0}
    .msg.user{justify-content:flex-end}
    .msg.bot{justify-content:flex-start}
    .bubble{max-width:min(680px, 92%);padding:10px 12px;border-radius:14px;border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.04);line-height:1.35}
    .msg.user .bubble{border-color:rgba(255,47,77,.35)}
    .msg.bot .bubble{border-color:rgba(255,107,107,.25)}
    .chat-compose{display:flex;gap:10px;align-items:flex-end}
    .chat-compose textarea{flex:1;resize:vertical;min-height:46px;max-height:160px}

    /* ===== OpenClaw: header + icon + less-red-glow overrides ===== */
    :root{
      --bg: #000;
      --panel: #050505;
      --panel2: #070707;
      --text: #f3f3f3;
      --muted: #9a9a9a;

      /* Keep "redline" as an accent, not a flashlight */
      --red: rgba(255, 60, 60, .55);
      --red2: rgba(255, 60, 60, .35);
      --glow: rgba(255, 60, 60, .16);
    }

    body{
      background: #000 !important;
      background-image: none !important;
    }

    /* Remove the heavy ambient red bloom */
    .glass{
      box-shadow: 0 10px 30px rgba(0,0,0,.65) !important;
      border-color: rgba(255,255,255,.06) !important;
      background: rgba(10,10,10,.65) !important;
      backdrop-filter: blur(10px);
    }
    .sidebar{
      box-shadow: none !important;
    }

    /* Page header banner */
    .pageHeader{
      width: 100%;
      margin: 10px 0 12px;
      padding: 10px;
      border-radius: 16px;
      background: #000;
      border: 1px solid rgba(255,255,255,.06);
    }
    .pageHeaderImg{
      display: block;
      width: 100%;
      height: auto;
      max-height: 220px;           /* desktop-ish */
      object-fit: contain;         /* no crop */
      object-position: center;
      border-radius: 12px;
    }
    @media (max-width: 760px){
      .pageHeader{ padding: 8px; border-radius: 14px; }
      .pageHeaderImg{ max-height: 160px; }  /* mobile */
    }

    /* Sidebar icon image */

    /* Sidebar video avatar */
    .avatarVideo{
      width:64px;
      height:64px;
      object-fit:contain;
      border-radius:12px;
      display:block;
      background:#000;
      pointer-events:none;
    }

    .avatarImg{
      width: 64px;
      height: 64px;
      object-fit: contain;
      display: block;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.65));
    }

    /* Animate the icon (subtle, not seizure-inducing) */
    @keyframes ocFloat {
      0%, 100% { transform: translateY(0) scale(1); }
      50% { transform: translateY(-4px) scale(1.02); }
    }
    @keyframes ocPulseGlow {
      0%, 100% { filter: drop-shadow(0 10px 18px rgba(0,0,0,.65)); opacity: 1; }
      50% { filter: drop-shadow(0 10px 18px rgba(0,0,0,.65)) drop-shadow(0 0 10px rgba(255,60,60,.18)); opacity: .98; }
    }
    .avatarAnim{
      animation: ocFloat 2.8s ease-in-out infinite, ocPulseGlow 3.6s ease-in-out infinite;
      will-change: transform, filter;
    }

    /* Tone down button glows */
    .btn{
      box-shadow: none !important;
    }
    .btn:hover{
      box-shadow: 0 10px 28px rgba(0,0,0,.55) !important;
    }
  </style>
</head>

<body>
  <div class="app">
    <aside class="sidebar glass">
      <div class="brand">
        <div class="avatar" title="AztroBot Avatar">
          <video class="avatarVideo avatarAnim"
  autoplay
  muted
  loop
  playsinline
 preload="auto" aria-label="OpenClaw icon animation">
  <source src="openclaw_icon.mp4" type="video/mp4">
  <img src="openclaw_icon2.png" alt="OpenClaw icon" class="avatarImg avatarAnim" />
</video>
        </div>
        <div>
          <h1>AztroBot // NiNjA-Claw</h1>
          <p>OpenClaw Android Companion</p>
        </div>
      </div>

      <nav class="menu" aria-label="Primary">
        <button class="menu-item active" data-view="dashboard">
          <span class="mi-icon">‚åÅ</span><span>Dashboard</span>
        </button>
        <button class="menu-item" data-view="sessions">
          <span class="mi-icon">‚è∫</span><span>Sessions</span>
        </button>
        <button class="menu-item" data-view="subagents">
          <span class="mi-icon">üß©</span><span>Subagents</span>
        </button>
        <button class="menu-item" data-view="agents">
          <span class="mi-icon">ü§ñ</span><span>Agents</span>
        </button>
        <button class="menu-item" data-view="workspace-files">
          <span class="mi-icon">üóÇ</span><span>Workspace Files</span>
        </button>
        <button class="menu-item" data-view="exec-terminal">
          <span class="mi-icon">‚å®</span><span>Exec Terminal</span>
        </button>
        <button class="menu-item" data-view="processes">
          <span class="mi-icon">‚öô</span><span>Processes</span>
        </button>
        <button class="menu-item" data-view="web-search">
          <span class="mi-icon">üîé</span><span>Web Search</span>
        </button>
        <button class="menu-item" data-view="web-fetch">
          <span class="mi-icon">‚¨á</span><span>Web Fetch</span>
        </button>
        <button class="menu-item" data-view="browser">
          <span class="mi-icon">üåê</span><span>Browser</span>
        </button>
        <button class="menu-item" data-view="canvas">
          <span class="mi-icon">‚ñ¶</span><span>Canvas</span>
        </button>
        <button class="menu-item" data-view="nodes">
          <span class="mi-icon">‚õì</span><span>Nodes</span>
        </button>
        <button class="menu-item" data-view="cron">
          <span class="mi-icon">‚è±</span><span>Cron</span>
        </button>
        <button class="menu-item" data-view="messages">
          <span class="mi-icon">‚úâ</span><span>Messages</span>
        </button>
        <button class="menu-item" data-view="memory">
          <span class="mi-icon">üß†</span><span>Memory</span>
        </button>
        <button class="menu-item" data-view="image-vision">
          <span class="mi-icon">üëÅ</span><span>Image Vision</span>
        </button>
        <button class="menu-item" data-view="tts">
          <span class="mi-icon">üîä</span><span>TTS</span>
        </button>
        <button class="menu-item" data-view="gateway">
          <span class="mi-icon">üîå</span><span>Gateway</span>
        </button>
        <button class="menu-item" data-view="settings">
          <span class="mi-icon">‚öô</span><span>Settings</span>
        </button>
        <button class="menu-item" data-view="router">
          <span class="mi-icon">‚åÇ</span><span>Router Control</span>
        </button>
        <button class="menu-item" data-view="openclaw">
          <span class="mi-icon">‚öô</span><span>OpenClaw</span>
        </button>
      </nav>

      <div style="margin-top:auto;border-top:1px dashed var(--line);padding-top:10px;color:var(--muted);font-size:12px">
        <span class="tag">Black background</span><span class="tag">Redline accents</span>
      </div>
    </aside>

    <main class="main">

      <div class="pageHeader" role="banner" aria-label="OpenClaw header">
        <img class="pageHeaderImg" src="new_assets/claw_control_final.png" alt="CLAW CONTROL ‚Äî OpenClaw Android Companion" />
      </div>
      <header class="topbar glass">
        <div class="status"><span class="dot"></span><span id="statusText">Gateway online ‚Ä¢ Node paired ‚Ä¢ Android companion active</span></div>
        <div class="toolbar">
          <button class="btn" id="scanBtn" type="button">Run Security Scan</button>
          <button class="btn" id="syncBtn" type="button">Sync Node</button>
          <button class="btn" id="demoBtn" type="button">Demo Alert</button>
        </div>
      </header>

      <section class="content">
        <section class="panel glass view" id="view-dashboard">
          <h2 style="margin:0 0 10px 0">Dashboard</h2>
          <p class="muted" style="margin:0">
            This is a UI shell. If you want real data here, it has to come from your gateway/node APIs, not cosmic hope.
          </p>
        </section>

        <section class="panel glass view hidden" id="view-nodes">
          <h2 style="margin:0 0 10px 0">Nodes</h2>
          <p class="muted" style="margin:0">Placeholder panel.</p>
        </section>

        <section class="panel glass view hidden" id="view-cron">
          <h2 style="margin:0 0 10px 0">Cron</h2>
          <p class="muted" style="margin:0">Placeholder panel.</p>
        </section>

        <section class="panel glass view hidden" id="view-router">
          <h2 style="margin:0 0 10px 0">Router Control</h2>
          <p class="muted" style="margin:0">UI placeholder. Router login/control needs actual backend + auth.</p>
        </section>

        <section class="panel glass view hidden" id="view-openclaw">
          <h2 style="margin:0 0 10px 0">OpenClaw</h2>
          <p class="muted" style="margin:0">UI placeholder for OpenClaw integrations.</p>
        </section>

        <!-- CHAT VIEW (REAL, ALWAYS PRESENT IN DOM) -->
        <section class="panel glass view hidden" id="view-messages">
          <div class="chat">
            <div class="chat-header">
              <div>
                <div style="font-weight:800">Chat</div>
                <div class="muted" style="font-size:12px">Chat with OpenClaw (messages are sent to your local gateway)</div>
              </div>
              <div class="chat-actions">
                <button class="btn" id="chatClearBtn" type="button">Clear</button>
              </div>
            </div>

            <div class="chat-log" id="chatLog" aria-live="polite" aria-label="Chat messages"></div>

            <div class="chat-compose">
              <textarea id="chatInput" rows="2" placeholder="Type a message‚Ä¶ (Enter to send, Shift+Enter for newline)"></textarea>
              <button class="btn primary" id="chatSendBtn" type="button">Send</button>
            </div>
          </div>
        </section>
      </section>
    </main>
  </div>

  <script>
    // ---------- Simple view switching (no magic menu generator, no missing DOM) ----------
    const menuButtons = Array.from(document.querySelectorAll('.menu .menu-item'));
    const views = Array.from(document.querySelectorAll('.view'));

    function showView(name) {
      const targetId = `view-${name}`;
      let target = document.getElementById(targetId);

      // If the target view doesn't exist yet, create a sane placeholder
      if (!target) {
        const container = document.querySelector('section.content');
        target = document.createElement('section');
        target.className = 'panel glass view';
        target.id = targetId;
        const pretty = name.replace(/-/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
        target.innerHTML = `
          <h2 style="margin:0 0 10px 0">${pretty}</h2>
          <p class="muted" style="margin:0">Not implemented in this companion dashboard yet. This is the menu item from <code>openclaw_dash.html</code>, so the UI is ready whenever the feature is.</p>
        `;
        container.appendChild(target);
      }

      // Re-query views so newly created sections participate
      const allViews = Array.from(document.querySelectorAll('.view'));
      allViews.forEach(v => v.classList.toggle('hidden', v.id !== targetId));
      menuButtons.forEach(b => b.classList.toggle('active', b.dataset.view === name));
    }

    menuButtons.forEach(btn => {
      btn.addEventListener('click', () => showView(btn.dataset.view));
    });

    // Default view
    showView('dashboard');

    // ---------- Topbar demo buttons ----------
    const statusText = document.getElementById('statusText');
    document.getElementById('demoBtn').addEventListener('click', () => {
      statusText.textContent = 'Demo: alert triggered (this is UI-only)';
      setTimeout(() => statusText.textContent = 'Gateway online ‚Ä¢ Node paired ‚Ä¢ Android companion active', 2500);
    });
    document.getElementById('scanBtn').addEventListener('click', () => {
      statusText.textContent = 'Scan requested‚Ä¶ (stub)';
      setTimeout(() => statusText.textContent = 'Gateway online ‚Ä¢ Node paired ‚Ä¢ Android companion active', 2000);
    });
    document.getElementById('syncBtn').addEventListener('click', () => {
      statusText.textContent = 'Sync requested‚Ä¶ (stub)';
      setTimeout(() => statusText.textContent = 'Gateway online ‚Ä¢ Node paired ‚Ä¢ Android companion active', 2000);
    });

    // ---------- Chat (local stub) ----------
    const chatLog = document.getElementById('chatLog');
    const chatInput = document.getElementById('chatInput');

    function appendMsg(role, text) {
      const row = document.createElement('div');
      row.className = `msg ${role}`;
      row.innerHTML = `<div class="bubble">${escapeHtml(text)}</div>`;
      chatLog.appendChild(row);
      chatLog.scrollTop = chatLog.scrollHeight;
    }

    function escapeHtml(str) {
      return String(str)
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;')
        .replaceAll("'", '&#039;')
        .replaceAll('\n', '<br/>');
    }

    async function sendChat() {
      const text = chatInput.value.trim();
      if (!text) return;
      // show the user message immediately
      appendMsg('user', text);
      chatInput.value = '';
      try {
        // Call the local OpenClaw chat API.  The gateway and channel are fixed for the companion UI.
        const res = await fetch('/api/openclaw/chat/send?gateway=default&channel=ui', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ body: text })
        });
        if (!res.ok) {
          const err = await res.text();
          appendMsg('bot', `Error: ${err || res.status}`);
          return;
        }
        const data = await res.json();
        // The server returns a message object; use 'text' or fallback to a generic reply.
        const reply = data?.body ?? '...';
        appendMsg('bot', reply);
      } catch (e) {
        appendMsg('bot', `Network error: ${e.message}`);
      }
    }

    document.getElementById('chatSendBtn').addEventListener('click', sendChat);
    document.getElementById('chatClearBtn').addEventListener('click', () => { chatLog.innerHTML = ''; });

    chatInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendChat();
      }
    });

    // Load initial chat history from the backend
    (async function loadMessages() {
      try {
        const res = await fetch('/api/openclaw/messages');
        if (res.ok) {
          const messages = await res.json();
          messages.forEach(m => {
            const role = m.gateway === 'user' ? 'user' : 'bot';
            appendMsg(role, m.body || '');
          });
        } else {
          console.warn('Failed to load messages', res.status);
        }
      } catch (e) {
        console.warn('Failed to fetch messages', e);
      }
    })();

    
    // ---------- Avatar video diagnostics + fallback ----------
    (function setupAvatarVideo(){
      const v = document.querySelector('.avatarVideo');
      if(!v) return;

      // If the codec/container isn't supported, fall back immediately.
      const canMp4 = v.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"') || v.canPlayType('video/mp4');
      if(!canMp4){
        console.warn('Avatar video: MP4 not supported by this browser/codec. Falling back to PNG.');
        v.outerHTML = '<img class="avatarImg avatarAnim" src="openclaw_icon2.png" alt="OpenClaw icon">';
        return;
      }

      v.addEventListener('error', () => {
        console.warn('Avatar video: failed to load/play. Check filename/path and codec. Falling back to PNG.');
        v.outerHTML = '<img class="avatarImg avatarAnim" src="openclaw_icon2.png" alt="OpenClaw icon">';
      });

      // Some browsers refuse autoplay until play() is called (even if muted).
      v.muted = true;
      const p = v.play();
      if(p && typeof p.catch === 'function'){
        p.catch(() => {
          console.warn('Avatar video: autoplay blocked. Falling back to PNG.');
          v.outerHTML = '<img class="avatarImg avatarAnim" src="openclaw_icon2.png" alt="OpenClaw icon">';
        });
      }
    })();

  </script>
</body>
</html>

