<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NEON-NOC // Network Discovery + Admin Control</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">

  <style>
    :root{
      /* Base (keeps your snippet’s spirit) */
      --bg0:#000;
      --glass: rgba(10, 25, 10, 0.52);
      --glass2: rgba(0,0,0,0.35);

      /* Neon upgrades (cyan + purple like you asked) */
      --glow-green:#4ade80;
      --glow-cyan:#22d3ee;
      --glow-purple:#a855f7;

      --border-green: rgba(74, 222, 128, 0.40);
      --border-cyan: rgba(34, 211, 238, 0.35);
      --border-purple: rgba(168, 85, 247, 0.35);

      --text-green: #a3b1a3;
      --text-cyan: rgba(34,211,238,0.9);
      --text-purple: rgba(168,85,247,0.9);
      --text-dim: rgba(163,177,163,0.75);

      --shadow: 0 0 25px rgba(0,0,0,0.55);
      --radius: 16px;
      --radius-sm: 10px;

      --ok: #22c55e;
      --warn: #eab308;
      --bad: #ef4444;
      --muted: rgba(71, 85, 105, 0.55);

      --grid-gap: 14px;
    }

    *{ box-sizing:border-box; }
    html, body { height:100%; }
    body{
      margin:0;
      font-family:'Share Tech Mono', monospace;
      background: var(--bg0);
      color: var(--text-green);
      overflow:hidden;
      text-shadow: 0 0 5px rgba(100,255,100,0.25);
    }

    /* CRT scanline overlay (your snippet vibe) */
    body::after{
      content:"";
      position:fixed; inset:0;
      pointer-events:none;
      z-index: 1000;
      background:
        linear-gradient(rgba(18,16,16,0) 50%, rgba(0,0,0,0.25) 50%),
        linear-gradient(90deg, rgba(255,0,0,0.06), rgba(0,255,0,0.02), rgba(0,0,255,0.06));
      background-size: 100% 2px, 3px 100%;
      animation: flicker .15s infinite;
      opacity:.55;
    }
    @keyframes flicker{
      0% { opacity: 0.25; } 20% { opacity: 0.85; } 40% { opacity: 0.35; }
      60% { opacity: 0.95; } 80% { opacity: 0.30; } 100% { opacity: 0.55; }
    }

    /* Neon animated background “grid + haze” (no external libs) */
    .bg{
      position:fixed; inset:0;
      z-index:-2;
      background:
        radial-gradient(1000px 600px at 20% 15%, rgba(34,211,238,0.10), transparent 55%),
        radial-gradient(900px 520px at 82% 25%, rgba(168,85,247,0.10), transparent 50%),
        radial-gradient(1200px 720px at 50% 90%, rgba(74,222,128,0.08), transparent 55%),
        linear-gradient(180deg, rgba(0,0,0,1), rgba(0,0,0,0.92));
      filter:saturate(120%);
    }
    .bg::before{
      content:"";
      position:absolute; inset:-10%;
      background:
        repeating-linear-gradient(0deg, rgba(34,211,238,0.06) 0 1px, transparent 1px 26px),
        repeating-linear-gradient(90deg, rgba(168,85,247,0.05) 0 1px, transparent 1px 30px);
      transform: perspective(900px) rotateX(55deg) translateY(140px);
      transform-origin: center;
      opacity:0.35;
      filter: blur(0.25px);
      animation: gridScroll 10s linear infinite;
    }
    @keyframes gridScroll{
      from{ background-position: 0 0, 0 0; }
      to{ background-position: 0 260px, 300px 0; }
    }

    /* Layout */
    .app{
      height:100%;
      display:grid;
      grid-template-columns: 270px 1fr 420px;
      grid-template-rows: 64px 1fr 240px;
      gap: var(--grid-gap);
      padding: 14px;
    }

    /* Window frame styles (your snippet, upgraded) */
    .window{
      background: var(--glass);
      border: 1px solid var(--border-green);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px) saturate(120%);
      -webkit-backdrop-filter: blur(10px) saturate(120%);
      overflow:hidden;
      position:relative;
    }
    .window.cyan { border-color: var(--border-cyan); }
    .window.purple { border-color: var(--border-purple); }

    .titlebar{
      background: var(--glass2);
      border-bottom: 1px solid rgba(255,255,255,0.04);
      padding: 10px 12px;
      display:flex;
      align-items:center;
      gap:10px;
      user-select:none;
    }
    .win-controls{
      display:flex; gap:6px;
      margin-right: 2px;
    }
    .win-controls span{
      width:12px; height:12px; border-radius:50%;
      background:#222; border: 1px solid #444;
      display:block;
    }
    .win-controls span:nth-child(1){ background:#ef4444; }
    .win-controls span:nth-child(2){ background:#eab308; }
    .win-controls span:nth-child(3){ background:#22c55e; }

    .title{
      display:flex; align-items:center; gap:10px;
      width:100%;
    }
    .title h1, .title h2{
      margin:0;
      font-size: 14px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: rgba(163,177,163,0.95);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .title .badge{
      font-size: 12px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.08);
      color: rgba(255,255,255,0.75);
      background: rgba(0,0,0,0.35);
    }

    /* Top bar */
    .topbar{ grid-column: 1 / 4; grid-row: 1; }
    .topbar .content{
      display:flex; align-items:center; justify-content:space-between;
      padding: 10px 12px;
      gap: 12px;
    }
    .leftCluster{
      display:flex; align-items:center; gap:10px;
      min-width: 420px;
    }
    .rightCluster{
      display:flex; align-items:center; gap:10px;
      justify-content:flex-end;
      flex-wrap:wrap;
    }

    /* Sidebar */
    .sidebar{ grid-column: 1; grid-row: 2 / 4; }
    .sidebar .body{ padding: 12px; display:flex; flex-direction:column; gap:12px; height: calc(100% - 44px); }
    .nav{
      display:flex; flex-direction:column; gap:8px;
    }
    .nav button{
      width:100%;
      text-align:left;
      padding: 10px 10px;
      border-radius: var(--radius-sm);
      border: 1px solid rgba(255,255,255,0.06);
      background: rgba(0,0,0,0.35);
      color: var(--text-dim);
      cursor:pointer;
      transition: all .15s ease;
      letter-spacing: 1px;
      text-transform: uppercase;
      font-size: 12px;
      display:flex; align-items:center; justify-content:space-between;
      gap: 8px;
    }
    .nav button:hover{
      border-color: rgba(34,211,238,0.35);
      color: rgba(34,211,238,0.92);
      box-shadow: 0 0 12px rgba(34,211,238,0.12);
    }
    .nav button.active{
      border-color: rgba(168,85,247,0.40);
      color: rgba(168,85,247,0.95);
      box-shadow: 0 0 14px rgba(168,85,247,0.12);
    }
    .nav .count{
      font-size: 11px;
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.08);
      background: rgba(0,0,0,0.25);
      color: rgba(255,255,255,0.70);
    }

    /* Main */
    .main{ grid-column: 2; grid-row: 2; }
    .main .body{
      padding: 12px;
      display:flex;
      flex-direction:column;
      gap: var(--grid-gap);
      height: calc(100% - 44px);
    }

    /* Details */
    .details{ grid-column: 3; grid-row: 2; }
    .details .body{
      padding: 12px;
      display:flex;
      flex-direction:column;
      gap: var(--grid-gap);
      height: calc(100% - 44px);
    }

    /* Bottom terminal/logs */
    .bottom{ grid-column: 2 / 4; grid-row: 3; }
    .bottom .body{
      padding: 12px;
      height: calc(100% - 44px);
      display:grid;
      grid-template-columns: 1fr 420px;
      gap: var(--grid-gap);
    }

    /* Controls + inputs */
    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .sep{ height:1px; background: rgba(255,255,255,0.05); margin: 8px 0; }

    .input, .select{
      background: rgba(0,0,0,0.45);
      border: 1px solid rgba(255,255,255,0.08);
      color: rgba(255,255,255,0.78);
      border-radius: 10px;
      padding: 10px 10px;
      outline:none;
      font-family: inherit;
      font-size: 12px;
      letter-spacing: 1px;
    }
    .input:focus, .select:focus{
      border-color: rgba(34,211,238,0.45);
      box-shadow: 0 0 0 3px rgba(34,211,238,0.12);
    }
    .sr-only{
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    /* Buttons (based on your .btn style, expanded) */
    .btn{
      background: transparent;
      border: 1px solid var(--border-green);
      color: var(--text-green);
      padding: 10px 12px;
      font-family: inherit;
      letter-spacing: 1px;
      font-weight: 700;
      transition: all .18s ease;
      text-transform: uppercase;
      border-radius: 10px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:8px;
      user-select:none;
      font-size: 12px;
      white-space:nowrap;
    }
    .btn:hover{
      background: rgba(74,222,128,0.18);
      color: #fff;
      border-color: var(--glow-green);
      text-shadow: 0 0 8px rgba(74,222,128,0.8);
      box-shadow: 0 0 14px rgba(74,222,128,0.10);
    }
    .btn:disabled{
      border-color: rgba(71,85,105,0.35);
      color: rgba(255,255,255,0.25);
      cursor:not-allowed;
      background: transparent;
      text-shadow:none;
      box-shadow:none;
    }
    .btn.cyan{ border-color: var(--border-cyan); color: rgba(34,211,238,0.85); }
    .btn.cyan:hover{
      background: rgba(34,211,238,0.16);
      border-color: var(--glow-cyan);
      text-shadow: 0 0 10px rgba(34,211,238,0.9);
      box-shadow: 0 0 16px rgba(34,211,238,0.10);
    }
    .btn.purple{ border-color: var(--border-purple); color: rgba(168,85,247,0.85); }
    .btn.purple:hover{
      background: rgba(168,85,247,0.16);
      border-color: var(--glow-purple);
      text-shadow: 0 0 10px rgba(168,85,247,0.9);
      box-shadow: 0 0 16px rgba(168,85,247,0.10);
    }
    .btn.danger{ border-color: rgba(239,68,68,0.50); color: rgba(239,68,68,0.85); }
    .btn.danger:hover{ background: rgba(239,68,68,0.18); border-color: #ef4444; text-shadow: 0 0 10px rgba(239,68,68,0.8); }

    /* Chip filters */
    .chips{ display:flex; gap:8px; flex-wrap:wrap; }
    .chip{
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.35);
      color: rgba(255,255,255,0.68);
      padding: 6px 10px;
      border-radius: 999px;
      cursor:pointer;
      transition: all .15s ease;
      font-size: 11px;
      letter-spacing: 1px;
      user-select:none;
    }
    .chip:hover{ border-color: rgba(34,211,238,0.35); color: rgba(34,211,238,0.9); }
    .chip.on{
      border-color: rgba(168,85,247,0.45);
      color: rgba(168,85,247,0.95);
      box-shadow: 0 0 12px rgba(168,85,247,0.10);
    }

    /* Status light (your snippet concept, expanded) */
    .status{
      display:flex; align-items:center; gap:10px;
      border: 1px solid rgba(255,255,255,0.07);
      background: rgba(0,0,0,0.35);
      padding: 8px 10px;
      border-radius: 12px;
      min-width: 220px;
    }
    .statusLight{
      width: 12px; height: 12px;
      border-radius: 50%;
      background: #444;
      transition: background-color .4s ease, box-shadow .4s ease;
    }
    .statusLight.ok{ background: var(--ok); box-shadow: 0 0 14px rgba(34,197,94,0.8); }
    .statusLight.warn{ background: var(--warn); box-shadow: 0 0 14px rgba(234,179,8,0.75); }
    .statusLight.bad{ background: var(--bad); box-shadow: 0 0 14px rgba(239,68,68,0.75); }
    .statusText{ font-size: 12px; letter-spacing: 1px; color: rgba(255,255,255,0.70); }

    /* Tables */
    .tableWrap{
      border: 1px solid rgba(255,255,255,0.06);
      background: rgba(0,0,0,0.28);
      border-radius: 14px;
      overflow:hidden;
      flex: 1;
      min-height: 220px;
      display:flex;
      flex-direction:column;
    }
    table{
      width:100%;
      border-collapse: collapse;
      font-size: 12px;
      letter-spacing: 1px;
    }
    thead{
      background: rgba(0,0,0,0.45);
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }
    th, td{
      padding: 10px 10px;
      border-bottom: 1px solid rgba(255,255,255,0.05);
      text-align:left;
      white-space:nowrap;
    }
    tbody tr{
      cursor:pointer;
      transition: background .12s ease, box-shadow .12s ease;
    }
    tbody tr:hover{
      background: rgba(34,211,238,0.06);
      box-shadow: inset 0 0 0 1px rgba(34,211,238,0.10);
    }
    tbody tr.selected{
      background: rgba(168,85,247,0.08);
      box-shadow: inset 0 0 0 1px rgba(168,85,247,0.20);
    }

    .pill{
      display:inline-flex; align-items:center; gap:6px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.25);
      font-size: 11px;
      color: rgba(255,255,255,0.70);
    }
    .dot{
      width:7px; height:7px; border-radius:50%;
      background:#666;
    }
    .dot.ok{ background: var(--ok); box-shadow: 0 0 8px rgba(34,197,94,0.65); }
    .dot.bad{ background: var(--bad); box-shadow: 0 0 8px rgba(239,68,68,0.65); }
    .dot.warn{ background: var(--warn); box-shadow: 0 0 8px rgba(234,179,8,0.55); }

    /* Cards */
    .card{
      border: 1px solid rgba(255,255,255,0.06);
      background: rgba(0,0,0,0.28);
      border-radius: 14px;
      padding: 10px;
    }
    .cardTitle{
      font-size: 12px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: rgba(255,255,255,0.70);
      margin-bottom: 8px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 8px;
    }
    .kv{
      display:grid;
      grid-template-columns: 130px 1fr;
      gap: 6px 10px;
      font-size: 12px;
      color: rgba(255,255,255,0.72);
    }
    .k{ color: rgba(163,177,163,0.7); }
    .v{ color: rgba(255,255,255,0.80); overflow:hidden; text-overflow:ellipsis; }

    /* Progress bars */
    .prog{
      height: 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.06);
      overflow:hidden;
    }
    .prog > i{
      display:block;
      height:100%;
      width: 0%;
      background: linear-gradient(90deg, rgba(34,211,238,0.85), rgba(168,85,247,0.85), rgba(74,222,128,0.75));
      box-shadow: 0 0 14px rgba(34,211,238,0.25);
      transition: width .35s ease;
    }

    /* Toggle */
    .toggle{
      display:flex; align-items:center; gap:10px;
      cursor:pointer;
      user-select:none;
    }
    .switch{
      width: 44px; height: 24px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.35);
      position:relative;
      transition: all .15s ease;
    }
    .switch::after{
      content:"";
      position:absolute;
      top: 3px; left: 3px;
      width: 18px; height: 18px;
      border-radius: 50%;
      background: rgba(255,255,255,0.65);
      transition: all .15s ease;
      box-shadow: 0 0 10px rgba(255,255,255,0.12);
    }
    .toggle.on .switch{
      border-color: rgba(34,211,238,0.35);
      box-shadow: 0 0 14px rgba(34,211,238,0.10);
    }
    .toggle.on .switch::after{
      left: 22px;
      background: rgba(34,211,238,0.95);
      box-shadow: 0 0 14px rgba(34,211,238,0.30);
    }
    .toggle span{
      font-size: 12px;
      letter-spacing: 1px;
      color: rgba(255,255,255,0.72);
    }

    /* Terminal */
    .terminal{
      height: 100%;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.07);
      background: rgba(0,0,0,0.45);
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }
    .termHead{
      display:flex; align-items:center; justify-content:space-between;
      padding: 8px 10px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      background: rgba(0,0,0,0.40);
      font-size: 12px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: rgba(255,255,255,0.70);
    }
    .termBody{
      padding: 10px;
      overflow:auto;
      font-size: 12px;
      color: rgba(34,211,238,0.85);
      line-height: 1.5;
      flex: 1;
    }
    .termLine.dim{ color: rgba(163,177,163,0.65); }
    .termLine.warn{ color: rgba(234,179,8,0.85); }
    .termLine.bad{ color: rgba(239,68,68,0.85); }
    .termLine.ok{ color: rgba(34,197,94,0.85); }

    .termInputRow{
      display:flex;
      gap: 8px;
      padding: 10px;
      border-top: 1px solid rgba(255,255,255,0.06);
      background: rgba(0,0,0,0.35);
    }
    .termPrompt{
      color: rgba(168,85,247,0.85);
      padding-top: 10px;
      font-size: 12px;
      white-space:nowrap;
    }
    .termInput{
      flex:1;
      background: rgba(0,0,0,0.55);
      border: 1px solid rgba(255,255,255,0.08);
      color: rgba(255,255,255,0.78);
      border-radius: 10px;
      padding: 10px;
      font-family: inherit;
      font-size: 12px;
      outline:none;
    }
    .termInput:focus{
      border-color: rgba(168,85,247,0.45);
      box-shadow: 0 0 0 3px rgba(168,85,247,0.12);
    }

    /* Modal */
    .modal{
      position:fixed; inset:0;
      display:none;
      align-items:center; justify-content:center;
      background: rgba(0,0,0,0.78);
      z-index: 2000;
      padding: 14px;
    }
    .modal.show{ display:flex; }
    .modal .panel{
      width: min(780px, 100%);
      border-radius: 16px;
      border: 1px solid rgba(239,68,68,0.25);
      background: rgba(10,25,10,0.60);
      backdrop-filter: blur(10px) saturate(120%);
      box-shadow: 0 0 40px rgba(0,0,0,0.70);
      overflow:hidden;
    }
    .modal .panel .body{ padding: 12px; display:flex; flex-direction:column; gap:12px; }

    /* Tiny helper */
    .monoDim{ color: rgba(163,177,163,0.7); font-size: 12px; letter-spacing: 1px; }
    .nowrap{ white-space:nowrap; }
    .grow{ flex:1; }
    .hidden{ display:none !important; }

    /* Responsive sanity (mobile won’t be perfect, but it won’t explode) */
    @media (max-width: 1200px){
      body{ overflow:auto; }
      .app{
        height:auto;
        grid-template-columns: 1fr;
        grid-template-rows: auto;
      }
      .topbar, .sidebar, .main, .details, .bottom{
        grid-column: 1;
        grid-row: auto;
      }
      .bottom .body{ grid-template-columns: 1fr; }
    }
  </style>

<link rel="stylesheet" href="./neon_dash.css">
<link rel="stylesheet" href="./neon_btns.css">
<link rel="stylesheet" href="./neon_btns.adapter.css">
<link rel="stylesheet" href="./cool_btns.css">

</head>

<body>
<div id=\"three-js-canvas\"></div>
<div class=\"dashboard-ui\">
  <div class="bg"></div>

  <div class="app">
    <!-- TOP BAR -->
    <section class="window cyan topbar">
      <div class="titlebar">
        <div class="win-controls"><span></span><span></span><span></span></div>
        <div class="title">
          <h1>NEON-NOC // Network Discovery + Admin Control Suite</h1>
          <span class="badge" id="buildBadge">LOCAL ENGINE: DISCONNECTED</span>
          <span class="badge" id="wsBadge">WS: IDLE</span>
        </div>
      </div>

      <div class="content">
        <div class="leftCluster">
          <div class="status">
            <div id="healthLight" class="statusLight warn"></div>
            <div class="statusText">
              <div id="healthText">ENGINE: STARTUP</div>
              <div class="monoDim" id="scanHint">Press SCAN to stream results (like a civilized UI). </div>
            </div>
          </div>

          <input class="input grow" id="search" placeholder="SEARCH: hostname / ip / mac / vendor / tag…" />
          <select class="select" id="scope">
            <option value="lan">SCOPE: LAN</option>
            <option value="subnet">SCOPE: SUBNET RANGE</option>
            <option value="custom">SCOPE: CUSTOM CIDR</option>
          </select>
        </div>

        <div class="rightCluster">
          <a href="#" class="btn cyan neon-btn" id="scanBtn"><span></span><span></span><span></span><span></span>SCAN</a>

          <div style="position:relative;">
            <a href="#" class="btn purple neon-btn" id="advancedBtn"><span></span><span></span><span></span><span></span>ADVANCED ▾</a>
            <div class="card hidden" id="advancedMenu" style="position:absolute; right:0; top:44px; width: 360px; z-index: 50;">
              <div class="cardTitle">Advanced scan (best-effort)</div>
              <div class="kv">
                <div class="k">CIDR</div><div class="v"><input class="input" id="cidr" style="width:100%;" value="192.168.1.0/24"/></div>
                <div class="k">Mode</div>
                <div class="v">
                  <select class="select" id="scanMode" style="width:100%;">
                    <option value="fast">FAST (ICMP/TCP sweep)</option>
                    <option value="balanced" selected>BALANCED (SWEEP + ARP + mDNS)</option>
                    <option value="deep">DEEP (ADD SSDP + OPTIONAL SNMP)</option>
                  </select>
                </div>
                <div class="k">Providers</div>
                <div class="v" style="display:flex; flex-direction:column; gap:8px;">
                  <label class="toggle on" id="t_icmp"><div class="switch"></div><span>ICMP / TCP Reachability</span></label>
                  <label class="toggle on" id="t_arp"><div class="switch"></div><span>ARP Table Parse</span></label>
                  <label class="toggle on" id="t_mdns"><div class="switch"></div><span>mDNS / Bonjour</span></label>
                  <label class="toggle" id="t_ssdp"><div class="switch"></div><span>SSDP / UPnP</span></label>
                  <label class="toggle" id="t_snmp"><div class="switch"></div><span>SNMP (read-only)</span></label>
                </div>
                <div class="k">Rate</div>
                <div class="v">
                  <select class="select" id="rate" style="width:100%;">
                    <option value="polite">POLITE</option>
                    <option value="normal" selected>NORMAL</option>
                    <option value="aggressive">AGGRESSIVE (DON’T BE SHOCKED)</option>
                  </select>
                </div>
              </div>
              <div class="sep"></div>
              <div class="row">
                <a href="#" class="btn cyan neon-btn" id="runAdvanced"><span></span><span></span><span></span><span></span>RUN ADVANCED SCAN</a>
                <a href="#" class="btn neon-btn" id="closeAdvanced"><span></span><span></span><span></span><span></span>CLOSE</a>
              </div>
              <div class="monoDim">
                Layered scan strategy: subnet estimation, reachability, ARP, mDNS, SSDP, optional SNMP. :contentReference[oaicite:2]{index=2}
              </div>
            </div>
          </div>

          <a href="#" class="btn neon-btn" id="exportBtn"><span></span><span></span><span></span><span></span>EXPORT</a>
          <a href="#" class="btn danger neon-btn" id="panicBtn"><span></span><span></span><span></span><span></span>PANIC STOP</a>
        </div>
      </div>
    </section>

    <!-- SIDEBAR -->
    <aside class="window sidebar">
      <div class="titlebar">
        <div class="win-controls"><span></span><span></span><span></span></div>
        <div class="title">
          <h2>Navigation</h2>
          <span class="badge" id="roleBadge">ROLE: ADMIN</span>
        </div>
      </div>
      <div class="body">
        <div class="nav" id="nav">
          <a href="#" class="active neon-btn" data-view="overview"><span></span><span></span><span></span><span></span>OVERVIEW <span class="count" id="cntOverview">1</span></a>
          <a href="#" data-view="devices" class="neon-btn"><span></span><span></span><span></span><span></span>DEVICES <span class="count" id="cntDevices">0</span></a>
          <a href="#" data-view="discovery" class="neon-btn"><span></span><span></span><span></span><span></span>DISCOVERY <span class="count" id="cntDiscovery">5</span></a>
          <a href="#" data-view="actions" class="neon-btn"><span></span><span></span><span></span><span></span>ACTIONS <span class="count" id="cntActions">6</span></a>
          <a href="#" data-view="automation" class="neon-btn"><span></span><span></span><span></span><span></span>AUTOMATION <span class="count" id="cntAutomation">3</span></a>
          <a href="#" data-view="alerts" class="neon-btn"><span></span><span></span><span></span><span></span>ALERTS <span class="count" id="cntAlerts">0</span></a>
          <a href="#" data-view="netreaper" class="neon-btn"><span></span><span></span><span></span><span></span>NETREAPER <span class="count" id="cntNetreaper">0</span></a>
          <a href="#" data-view="settings" class="neon-btn"><span></span><span></span><span></span><span></span>SETTINGS <span class="count" id="cntSettings">7</span></a>
          <a href="#" data-view="logs" class="neon-btn"><span></span><span></span><span></span><span></span>AUDIT LOGS <span class="count" id="cntLogs">0</span></a>
        </div>

        <div class="card">
          <div class="cardTitle">Quick status</div>
          <div class="kv">
            <div class="k">Network</div><div class="v" id="netName">Network</div>
            <div class="k">CIDR</div><div class="v" id="netCidr">192.168.1.0/24</div>
            <div class="k">Gateway</div><div class="v" id="netGw">192.168.1.1</div>
            <div class="k">Jobs</div><div class="v"><span class="pill"><span class="dot warn"></span><span id="jobsCount">0 active</span></span></div>
          </div>
        </div>

        <div class="card">
          <div class="cardTitle">UX guardrails</div>
          <div class="monoDim">
            Single Scan + Advanced dropdown. Search, filter chips, bulk actions. Tooltips that explain things like we’re all exhausted. :contentReference[oaicite:3]{index=3}
          </div>
        </div>
      </div>
    </aside>

    <!-- MAIN -->
    <main class="window main cyan">
      <div class="titlebar">
        <div class="win-controls"><span></span><span></span><span></span></div>
        <div class="title">
          <h2 id="mainTitle">Overview</h2>
          <span class="badge" id="streamBadge">STREAM: OFF</span>
        </div>
      </div>

      <div class="body">
        <!-- FILTERS + BULK ACTIONS (always visible per blueprint UX) -->
        <div class="row">
          <div class="chips" id="chips">
            <div class="chip" data-chip="online">ONLINE</div>
            <div class="chip" data-chip="offline">OFFLINE</div>
            <div class="chip" data-chip="os:windows">OS: WINDOWS</div>
            <div class="chip" data-chip="os:linux">OS: LINUX</div>
            <div class="chip" data-chip="os:android">OS: ANDROID</div>
            <div class="chip" data-chip="vendor:apple">VENDOR: APPLE</div>
            <div class="chip" data-chip="vendor:tp-link">VENDOR: TP-LINK</div>
            <div class="chip" data-chip="tag:iot">TAG: IOT</div>
            <div class="chip" data-chip="tag:server">TAG: SERVER</div>
          </div>

          <div class="row" style="margin-left:auto;">
            <a href="#" class="btn neon-btn" id="tagBtn" disabled><span></span><span></span><span></span><span></span>TAG</a>
            <a href="#" class="btn cyan neon-btn" id="bulkPingBtn" disabled><span></span><span></span><span></span><span></span>BULK PING</a>
            <a href="#" class="btn purple neon-btn" id="bulkWolBtn" disabled><span></span><span></span><span></span><span></span>BULK WOL</a>
            <a href="#" class="btn neon-btn" id="bulkHttpBtn" disabled><span></span><span></span><span></span><span></span>HTTP CHECK</a>
            <a href="#" class="btn danger neon-btn" id="bulkSshBtn" disabled><span></span><span></span><span></span><span></span>SSH RUN</a>
          </div>
        </div>

        <div class="sep"></div>

        <!-- VIEWS -->
        <section id="view-overview" class="view">
          <div class="row" style="gap: var(--grid-gap);">
            <div class="card" style="flex:1;">
              <div class="cardTitle">Discovery pipeline</div>
              <div class="kv">
                <div class="k">Subnet estimate</div><div class="v"><span class="pill"><span class="dot ok"></span>Interface/DHCP</span></div>
                <div class="k">Reachability</div><div class="v"><span class="pill"><span class="dot warn"></span>ICMP/TCP sweep</span></div>
                <div class="k">ARP map</div><div class="v"><span class="pill"><span class="dot warn"></span>OS-specific parse</span></div>
                <div class="k">mDNS</div><div class="v"><span class="pill"><span class="dot warn"></span>Names/services</span></div>
                <div class="k">SSDP</div><div class="v"><span class="pill"><span class="dot"></span>Optional</span></div>
                <div class="k">SNMP</div><div class="v"><span class="pill"><span class="dot"></span>Optional (read-only)</span></div>
              </div>
              <div class="monoDim" style="margin-top:8px;">
                Layered strategy and “don’t rely on one magic scan.” :contentReference[oaicite:4]{index=4}
              </div>
            </div>

            <div class="card" style="flex:1;">
              <div class="cardTitle">Inventory snapshot</div>
              <div class="kv">
                <div class="k">Devices</div><div class="v"><span class="pill"><span class="dot ok"></span><span id="statDevices">0</span></span></div>
                <div class="k">Online</div><div class="v"><span class="pill"><span class="dot ok"></span><span id="statOnline">0</span></span></div>
                <div class="k">Offline</div><div class="v"><span class="pill"><span class="dot bad"></span><span id="statOffline">0</span></span></div>
                <div class="k">New (last scan)</div><div class="v"><span class="pill"><span class="dot warn"></span><span id="statNew">0</span></span></div>
                <div class="k">Changed</div><div class="v"><span class="pill"><span class="dot warn"></span><span id="statChanged">0</span></span></div>
              </div>
              <div class="sep"></div>
              <div class="cardTitle">Job streaming</div>
              <div class="prog"><i id="jobProg"></i></div>
              <div class="monoDim" style="margin-top:8px;">
                Results should stream quickly and not freeze UI. (We’re simulating it, but the layout is correct.) :contentReference[oaicite:5]{index=5}
              </div>
            </div>
          </div>

          <div class="tableWrap" style="margin-top: var(--grid-gap);">
            <div class="cardTitle" style="padding: 10px 10px; margin:0;">
              Recent devices
              <span class="monoDim">Click a row to open full details + actions.</span>
            </div>
            <div style="overflow:auto; flex:1;">
              <table>
                <thead>
                  <tr>
                    <th class="nowrap">STATE</th>
                    <th>HOSTNAME</th>
                    <th>IP</th>
                    <th>MAC</th>
                    <th>VENDOR</th>
                    <th>OS GUESS</th>
                    <th class="nowrap">TAGS</th>
                  </tr>
                </thead>
                <tbody id="recentBody"></tbody>
              </table>
            </div>
          </div>
        </section>

        <section id="view-devices" class="view hidden">
          <div class="tableWrap">
            <div class="cardTitle" style="padding:10px 10px; margin:0;">
              Devices (inventory)
              <span class="monoDim">Sorting/filtering/bulk actions, because humans love clicking.</span>
            </div>
            <div style="overflow:auto; flex:1;">
              <table>
                <thead>
                  <tr>
                    <th></th>
                    <th>STATE</th>
                    <th>HOSTNAME</th>
                    <th>IP (CURRENT)</th>
                    <th>IP HISTORY</th>
                    <th>MAC</th>
                    <th>VENDOR</th>
                    <th>PORTS</th>
                    <th>SERVICES</th>
                    <th>mDNS/SSDP</th>
                    <th>TAGS</th>
                  </tr>
                </thead>
                <tbody id="devicesBody"></tbody>
              </table>
            </div>
          </div>
          <div class="monoDim" style="margin-top:10px;">
            Inventory should include OS guess, vendor, MAC/IP history, ports/services, names when possible. :contentReference[oaicite:6]{index=6}
          </div>
        </section>

        <section id="view-discovery" class="view hidden">
          <div class="row" style="gap: var(--grid-gap);">
            <div class="card" style="flex:1;">
              <div class="cardTitle">Providers</div>
              <div class="kv">
                <div class="k">ICMP/TCP sweep</div><div class="v"><span class="pill"><span class="dot ok"></span>Enabled</span></div>
                <div class="k">ARP parse</div><div class="v"><span class="pill"><span class="dot ok"></span>Enabled</span></div>
                <div class="k">mDNS</div><div class="v"><span class="pill"><span class="dot ok"></span>Enabled</span></div>
                <div class="k">SSDP</div><div class="v"><span class="pill"><span class="dot"></span>Optional</span></div>
                <div class="k">SNMP</div><div class="v"><span class="pill"><span class="dot"></span>Optional</span></div>
              </div>
            </div>

            <div class="card" style="flex:1;">
              <div class="cardTitle">Scan jobs</div>
              <div class="kv">
                <div class="k">Endpoint</div><div class="v">POST /api/v1/discovery/scan</div>
                <div class="k">Stream</div><div class="v">WebSocket job channel</div>
                <div class="k">Storage</div><div class="v">SQLite inventory</div>
              </div>
              <div class="monoDim" style="margin-top:8px;">
                UI triggers scan, engine streams results to storage + UI. :contentReference[oaicite:7]{index=7}
              </div>
            </div>
          </div>

          <div class="card">
            <div class="cardTitle">Subnet estimation (sim)</div>
            <div class="row">
              <select class="select">
                <option>INTERFACES: wlan0</option>
                <option>INTERFACES: eth0</option>
              </select>
              <select class="select">
                <option>DHCP: 192.168.1.120 / 255.255.255.0</option>
              </select>
              <a href="#" class="btn cyan neon-btn" id="inferBtn"><span></span><span></span><span></span><span></span>INFER SUBNET</a>
              <span class="monoDim" id="inferOut">Waiting…</span>
            </div>
          </div>

          <div class="card">
            <div class="cardTitle">Discovery notes</div>
            <div class="monoDim">
              Multiple signals, best-effort. Devices lie. Networks are messy. Humans still demand “one click.” :contentReference[oaicite:8]{index=8}
            </div>
          </div>
        </section>

        <section id="view-actions" class="view hidden">
          <div class="row" style="gap: var(--grid-gap);">
            <div class="card" style="flex:1;">
              <div class="cardTitle">Safe actions (opt-in + logged)</div>
              <div class="row">
                <a href="#" class="btn cyan neon-btn" id="actPing"><span></span><span></span><span></span><span></span>PING</a>
                <a href="#" class="btn purple neon-btn" id="actWol"><span></span><span></span><span></span><span></span>WAKE-ON-LAN</a>
                <a href="#" class="btn neon-btn" id="actHttp"><span></span><span></span><span></span><span></span>HTTP/S CHECK</a>
                <a href="#" class="btn danger neon-btn" id="actSsh"><span></span><span></span><span></span><span></span>SSH COMMAND</a>
                <a href="#" class="btn neon-btn" id="actSnmp"><span></span><span></span><span></span><span></span>SNMP GET (RO)</a>
              </div>
              <div class="monoDim" style="margin-top:10px;">
                Actions are permissioned, logged, and not destructive by default. :contentReference[oaicite:9]{index=9}
              </div>
            </div>

            <div class="card" style="flex:1;">
              <div class="cardTitle">Action guardrails</div>
              <div class="kv">
                <div class="k">Role</div><div class="v"><span class="pill"><span class="dot ok"></span>ADMIN</span></div>
                <div class="k">Secrets</div><div class="v">Never store plaintext creds</div>
                <div class="k">Destructive</div><div class="v">Blocked (phase 1)</div>
                <div class="k">Audit</div><div class="v">Every action logged</div>
              </div>
              <div class="monoDim" style="margin-top:8px;">
                “Don’t be reckless” security model. :contentReference[oaicite:10]{index=10}
              </div>
            </div>
          </div>

          <div class="card">
            <div class="cardTitle">Pluggable actions</div>
            <div class="monoDim">
              Add WinRM/WMI later without rewriting the UI. The layout already has the slots. :contentReference[oaicite:11]{index=11}
            </div>
          </div>
        </section>

        <section id="view-automation" class="view hidden">
          <div class="row" style="gap: var(--grid-gap);">
            <div class="card" style="flex:1;">
              <div class="cardTitle">Scheduled scans</div>
              <div class="row">
                <select class="select" id="schedFreq">
                  <option>EVERY 5 MIN</option>
                  <option selected>EVERY 15 MIN</option>
                  <option>HOURLY</option>
                  <option>DAILY</option>
                </select>
                <a href="#" class="btn cyan neon-btn" id="addSchedule"><span></span><span></span><span></span><span></span>ADD SCHEDULE</a>
                <a href="#" class="btn neon-btn" id="pauseSchedules"><span></span><span></span><span></span><span></span>PAUSE ALL</a>
              </div>
              <div class="sep"></div>
              <div id="schedules" class="monoDim">No schedules (yet).</div>
            </div>

            <div class="card" style="flex:1;">
              <div class="cardTitle">Playbooks</div>
              <div class="monoDim">
                Example: “when device appears, run X.” Because automation is just humans admitting they hate repetitive work. :contentReference[oaicite:12]{index=12}
              </div>
              <div class="sep"></div>
              <div class="row">
                <input class="input grow" id="ruleMatch" placeholder="MATCH: tag:iot OR vendor:tp-link …"/>
                <select class="select" id="ruleAction">
                  <option>PING</option>
                  <option>HTTP CHECK</option>
                  <option>SNMP GET</option>
                </select>
                <a href="#" class="btn purple neon-btn" id="addRule"><span></span><span></span><span></span><span></span>ADD RULE</a>
              </div>
              <div class="sep"></div>
              <div id="rules" class="monoDim">No rules (yet).</div>
            </div>
          </div>
        </section>

        <section id="view-alerts" class="view hidden">
          <div class="card">
            <div class="cardTitle">Alerts</div>
            <div class="monoDim">
              Hook point for “device appeared / changed / went offline” notifications and escalation.
              (UI is ready; wire to engine later.)
            </div>
          </div>
          <div class="tableWrap">
            <div class="cardTitle" style="padding:10px 10px; margin:0;">
              Alert feed <span class="monoDim">(empty)</span>
            </div>
            <div style="overflow:auto; flex:1;">
              <table>
                <thead><tr><th>TIME</th><th>SEVERITY</th><th>EVENT</th><th>DEVICE</th></tr></thead>
                <tbody id="alertsBody"></tbody>
              </table>
            </div>
          </div>
        </section>

        <section id="view-netreaper" class="view hidden">
          <div class="row" style="gap: var(--grid-gap);">
            <div class="card" style="flex:1;">
              <div class="cardTitle">NetReaper Control</div>
              <div class="kv">
                <div class="k">Service URL</div>
                <div class="v">
                  <label class="sr-only" for="netreaperUrl">NetReaper service URL</label>
                  <input id="netreaperUrl" class="input" placeholder="http://127.0.0.1:9088" />
                </div>
                <div class="k">Password</div>
                <div class="v">
                  <label class="sr-only" for="netreaperPassword">NetReaper password</label>
                  <input id="netreaperPassword" class="input" type="password" placeholder="NETREAPER_PASSWORD" />
                </div>
                <div class="k">Status</div>
                <div class="v"><span class="pill"><span class="dot warn"></span><span id="netreaperStatus">DISCONNECTED</span></span></div>
              </div>
              <div class="row" style="margin-top:10px;">
                <a href="#" class="btn neon-btn" id="netreaperAuthBtn"><span></span><span></span><span></span><span></span>AUTH</a>
                <a href="#" class="btn neon-btn" id="netreaperWsBtn"><span></span><span></span><span></span><span></span>STREAM LOGS</a>
              </div>
              <div class="monoDim" style="margin-top:8px;">
                NetReaper runs as a local FastAPI service. Configure URL + password before invoking actions.
              </div>
            </div>

            <div class="card" style="flex:1;">
              <div class="cardTitle">Actions</div>
              <div class="kv">
                <div class="k">Target</div>
                <div class="v">
                  <label class="sr-only" for="netreaperTarget">Scan target</label>
                  <input id="netreaperTarget" class="input" placeholder="192.168.1.1 or 192.168.1.0/24" />
                </div>
                <div class="k">Mode</div>
                <div class="v">
                  <label class="sr-only" for="netreaperMode">Scan mode</label>
                  <select id="netreaperMode" class="input">
                    <option value="quick">Quick Scan</option>
                    <option value="wifi">WiFi Scan</option>
                  </select>
                </div>
              </div>
              <div class="row" style="margin-top:10px;">
                <a href="#" class="btn neon-btn" id="netreaperScanBtn"><span></span><span></span><span></span><span></span>SCAN</a>
                <a href="#" class="btn neon-btn" id="netreaperDevicesBtn"><span></span><span></span><span></span><span></span>LIST DEVICES</a>
                <a href="#" class="btn neon-btn" id="netreaperReportBtn"><span></span><span></span><span></span><span></span>GET REPORT</a>
              </div>
              <div class="monoDim" style="margin-top:8px;">
                REST actions: scan, list devices, get report. Results are shown below.
              </div>
            </div>
          </div>

          <div class="tableWrap" style="margin-top: var(--grid-gap);">
            <div class="cardTitle" style="padding:10px 10px; margin:0;">
              Output
              <span class="monoDim">NetReaper responses and parsed device data.</span>
            </div>
            <div id="netreaperOutput" class="termBody" style="height: 240px; overflow:auto; padding:10px;"></div>
          </div>
        </section>

        <section id="view-settings" class="view hidden">
          <div class="row" style="gap: var(--grid-gap);">
            <div class="card" style="flex:1;">
              <div class="cardTitle">Access control</div>
              <div class="kv">
                <div class="k">RBAC</div><div class="v"><span class="pill"><span class="dot ok"></span>Admin vs Viewer</span></div>
                <div class="k">API tokens</div><div class="v">Local UI token (phase 1)</div>
                <div class="k">Remote</div><div class="v">mTLS/OAuth later</div>
              </div>
              <div class="monoDim" style="margin-top:8px;">
                Security model: RBAC, tokens, no auto destructive. :contentReference[oaicite:13]{index=13}
              </div>
            </div>
            <div class="card" style="flex:1;">
              <div class="cardTitle">Preferences</div>
              <label class="toggle on" id="t_stream"><div class="switch"></div><span>STREAM RESULTS TO UI</span></label>
              <label class="toggle on" id="t_cache"><div class="switch"></div><span>CACHE OUI LOOKUPS</span></label>
              <label class="toggle" id="t_tooltips"><div class="switch"></div><span>ELI5 TOOLTIPS</span></label>
              <label class="toggle on" id="t_audit"><div class="switch"></div><span>AUDIT EVERYTHING</span></label>
            </div>
          </div>

          <div class="card">
            <div class="cardTitle">Non-goals</div>
            <div class="monoDim">
              No NAC replacement. No deep packet inspection. No “hack the planet.” That’s not a product feature, it’s a lawsuit. :contentReference[oaicite:14]{index=14}
            </div>
          </div>
        </section>

        <section id="view-logs" class="view hidden">
          <div class="tableWrap">
            <div class="cardTitle" style="padding:10px 10px; margin:0;">
              Audit log <span class="monoDim">Actions are logged because that’s what “safe” means.</span>
            </div>
            <div style="overflow:auto; flex:1;">
              <table>
                <thead><tr><th>TIME</th><th>ACTOR</th><th>ACTION</th><th>TARGET</th><th>RESULT</th></tr></thead>
                <tbody id="auditBody"></tbody>
              </table>
            </div>
          </div>
        </section>
      </div>
    </main>

    <!-- DETAILS -->
    <aside class="window details purple">
      <div class="titlebar">
        <div class="win-controls"><span></span><span></span><span></span></div>
        <div class="title">
          <h2>Device detail</h2>
          <span class="badge" id="selBadge">NONE SELECTED</span>
        </div>
      </div>

      <div class="body">
        <div class="card">
          <div class="cardTitle">
            Selected device
            <span class="monoDim" id="selSub">Click any device row</span>
          </div>
          <div class="kv" id="detailKv">
            <div class="k">Hostname</div><div class="v">—</div>
            <div class="k">IP</div><div class="v">—</div>
            <div class="k">MAC</div><div class="v">—</div>
            <div class="k">Vendor</div><div class="v">—</div>
            <div class="k">OS guess</div><div class="v">—</div>
            <div class="k">Names</div><div class="v">mDNS/SSDP: —</div>
            <div class="k">Ports</div><div class="v">—</div>
            <div class="k">Services</div><div class="v">—</div>
            <div class="k">IP history</div><div class="v">—</div>
            <div class="k">Tags</div><div class="v">—</div>
          </div>
        </div>

        <div class="card">
          <div class="cardTitle">Quick actions</div>
          <div class="row">
            <a href="#" class="btn cyan neon-btn" id="dPing" disabled><span></span><span></span><span></span><span></span>PING</a>
            <a href="#" class="btn purple neon-btn" id="dWol" disabled><span></span><span></span><span></span><span></span>WOL</a>
            <a href="#" class="btn neon-btn" id="dHttp" disabled><span></span><span></span><span></span><span></span>HTTP</a>
            <a href="#" class="btn danger neon-btn" id="dSsh" disabled><span></span><span></span><span></span><span></span>SSH</a>
            <a href="#" class="btn neon-btn" id="dSnmp" disabled><span></span><span></span><span></span><span></span>SNMP</a>
          </div>
          <div class="sep"></div>
          <div class="row">
            <input class="input grow" id="tagInput" placeholder="Add tag (e.g. iot, server, printer) …" disabled />
            <a href="#" class="btn neon-btn" id="addTag" disabled><span></span><span></span><span></span><span></span>ADD TAG</a>
            <a href="#" class="btn danger neon-btn" id="removeTag" disabled><span></span><span></span><span></span><span></span>REMOVE TAG</a>
          </div>
        </div>

        <div class="card">
          <div class="cardTitle">Live metrics (sim)</div>
          <div class="kv">
            <div class="k">RTT</div><div class="v" id="mRtt">—</div>
            <div class="k">HTTP</div><div class="v" id="mHttp">—</div>
            <div class="k">Last seen</div><div class="v" id="mSeen">—</div>
            <div class="k">Change score</div><div class="v" id="mChange">—</div>
          </div>
        </div>
      </div>
    </aside>

    <!-- BOTTOM: TERMINAL + JOBS -->
    <section class="window bottom cyan">
      <div class="titlebar">
        <div class="win-controls"><span></span><span></span><span></span></div>
        <div class="title">
          <h2>Operations</h2>
          <span class="badge" id="opsBadge">READY</span>
        </div>
      </div>

      <div class="body">
        <div class="terminal">
          <div class="termHead">
            <span>Mini terminal</span>
            <span class="monoDim">Simulated, but wired like a real one should be.</span>
          </div>
          <div class="termBody" id="termBody"></div>
          <div class="termInputRow">
            <div class="termPrompt">noc$</div>
            <input class="termInput" id="termInput" placeholder="type: help, scan, ping 192.168.1.1, wol AA:BB:CC:DD:EE:FF …"/>
            <a href="#" class="btn purple neon-btn" id="termSend"><span></span><span></span><span></span><span></span>SEND</a>
          </div>
        </div>

        <div class="card">
          <div class="cardTitle">Jobs + progress</div>
          <div class="kv">
            <div class="k">Active job</div><div class="v" id="jobName">none</div>
            <div class="k">Phase</div><div class="v" id="jobPhase">—</div>
            <div class="k">Devices found</div><div class="v" id="jobFound">0</div>
            <div class="k">Streaming</div><div class="v" id="jobStream">OFF</div>
          </div>
          <div class="sep"></div>
          <div class="prog"><i id="jobProg2"></i></div>
          <div class="sep"></div>
          <div class="row">
            <a href="#" class="btn cyan neon-btn" id="jobPause"><span></span><span></span><span></span><span></span>PAUSE</a>
            <a href="#" class="btn neon-btn" id="jobResume"><span></span><span></span><span></span><span></span>RESUME</a>
            <a href="#" class="btn danger neon-btn" id="jobCancel"><span></span><span></span><span></span><span></span>CANCEL</a>
          </div>
          <div class="monoDim" style="margin-top:8px;">
            Streaming scan results is the whole point: incremental UI, no freezing. :contentReference[oaicite:15]{index=15}
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- MODAL: SSH -->
  <div class="modal" id="sshModal">
    <div class="panel">
      <div class="titlebar">
        <div class="win-controls"><span></span><span></span><span></span></div>
        <div class="title">
          <h2>SSH Command Runner</h2>
          <span class="badge">NO PLAINTEXT STORAGE</span>
        </div>
      </div>
      <div class="body">
        <div class="monoDim">
          SSH requires user-supplied credentials and should never store plaintext. :contentReference[oaicite:16]{index=16}
        </div>
        <div class="row">
          <input class="input grow" id="sshHost" placeholder="host (ip or name)"/>
          <input class="input" id="sshUser" placeholder="user" style="width: 160px;"/>
          <input class="input" id="sshPass" placeholder="password (sim)" style="width: 220px;" type="password"/>
        </div>
        <div class="row">
          <input class="input grow" id="sshCmd" placeholder="command (e.g. uname -a, ip a, systemctl status …)"/>
        </div>
        <div class="row">
          <a href="#" class="btn danger neon-btn" id="sshRun"><span></span><span></span><span></span><span></span>RUN</a>
          <a href="#" class="btn neon-btn" id="sshClose"><span></span><span></span><span></span><span></span>CLOSE</a>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL: PANIC -->
  <div class="modal" id="panicModal">
    <div class="panel">
      <div class="titlebar">
        <div class="win-controls"><span></span><span></span><span></span></div>
        <div class="title">
          <h2 class="nowrap">!_PANIC_STOP_!</h2>
          <span class="badge">JOB TERMINATION</span>
        </div>
      </div>
      <div class="body">
        <div class="monoDim">
          This cancels active scans/actions. You wanted a button. Humans love buttons.
        </div>
        <div class="row">
          <a href="#" class="btn danger neon-btn" id="panicConfirm"><span></span><span></span><span></span><span></span>CONFIRM STOP</a>
          <a href="#" class="btn neon-btn" id="panicClose"><span></span><span></span><span></span><span></span>CLOSE</a>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ==============================
    // Data model
    // ==============================
    const state = {
      view: 'overview',
      devices: [],
      selectedId: null,
      filters: new Set(),
      search: '',
      streaming: true,
      streamTimer: null,
      bulkSshIds: [],
      metrics: {},
      deviceMetrics: new Map(),
      job: {
        active: false,
        name: 'none',
        phase: '—',
        found: 0,
        progress: 0,
        paused: false,
        timer: null,
      },
      schedules: [],
      rules: [],
      audit: [],
      alerts: [],
      netreaper: {
        baseUrl: '',
        token: '',
        jobs: [],
        ws: null,
      },
    };

    const $ = (id) => document.getElementById(id);
    const now = () => new Date().toLocaleString();

    const API_BASE = (() => {
      try {
        if (location && location.origin && location.origin !== "null") return location.origin;
      } catch (_) {}
      return "http://127.0.0.1:8787";
    })();

    async function api(path, opts = {}) {
      const res = await fetch(API_BASE + path, Object.assign({
        headers: { "Content-Type": "application/json" }
      }, opts));
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const ct = res.headers.get("content-type") || "";
      return ct.includes("application/json") ? res.json() : res.text();
    }

    function postJson(path, body) {
      return api(path, { method: "POST", body: JSON.stringify(body ?? {}) });
    }

    const NETREAPER_DEFAULT = "http://127.0.0.1:9088";

    function getNetreaperBase() {
      const input = $('netreaperUrl');
      const saved = localStorage.getItem('netreaperUrl') || NETREAPER_DEFAULT;
      if (input && !input.value) input.value = saved;
      return (input?.value || saved).trim();
    }

    function netreaperHeaders() {
      if (!state.netreaper.token) return {};
      return { Authorization: `Bearer ${state.netreaper.token}` };
    }

    function netreaperLog(message, cls = 'dim') {
      const out = $('netreaperOutput');
      if (!out) return;
      const line = document.createElement('div');
      line.className = `termLine ${cls}`;
      line.textContent = message;
      out.appendChild(line);
      out.scrollTop = out.scrollHeight;
    }

    function setNetreaperStatus(text, ok = false) {
      const el = $('netreaperStatus');
      if (!el) return;
      el.textContent = text;
      const dot = el.parentElement?.querySelector('.dot');
      if (dot) dot.className = `dot ${ok ? 'ok' : 'warn'}`;
    }

    async function netreaperAuth() {
      const password = $('netreaperPassword')?.value || '';
      if (!password.trim()) {
        netreaperLog('Missing password for NetReaper auth.', 'warn');
        return;
      }
      try {
        const base = getNetreaperBase();
        const res = await fetch(`${base}/auth`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ password })
        });
        if (!res.ok) throw new Error(`Auth failed (${res.status})`);
        const data = await res.json();
        state.netreaper.token = data.token;
        setNetreaperStatus('AUTHENTICATED', true);
        netreaperLog('NetReaper authenticated.', 'ok');
        bumpCounts();
      } catch (err) {
        setNetreaperStatus('AUTH FAILED');
        netreaperLog(`NetReaper auth error: ${err.message}`, 'warn');
      }
    }

    async function netreaperScan() {
      const target = $('netreaperTarget')?.value || '';
      const mode = $('netreaperMode')?.value || 'quick';
      if (!target.trim() && mode !== 'wifi') {
        netreaperLog('Scan target is required for quick scan.', 'warn');
        return;
      }
      try {
        const base = getNetreaperBase();
        const res = await fetch(`${base}/api/netreaper/scan`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', ...netreaperHeaders() },
          body: JSON.stringify({ target: target || 'wifi', mode })
        });
        if (!res.ok) throw new Error(`Scan failed (${res.status})`);
        const data = await res.json();
        state.netreaper.jobs.unshift({ id: data.job_id, target, mode, ts: Date.now() });
        netreaperLog(`Scan queued: job ${data.job_id}`, 'ok');
        bumpCounts();
      } catch (err) {
        netreaperLog(`Scan error: ${err.message}`, 'warn');
      }
    }

    async function netreaperDevices() {
      try {
        const base = getNetreaperBase();
        const res = await fetch(`${base}/api/netreaper/devices`, {
          headers: { ...netreaperHeaders() }
        });
        if (!res.ok) throw new Error(`Device list failed (${res.status})`);
        const data = await res.json();
        netreaperLog(`Devices: ${JSON.stringify(data.devices ?? [], null, 2)}`, 'ok');
      } catch (err) {
        netreaperLog(`Device list error: ${err.message}`, 'warn');
      }
    }

    async function netreaperReport() {
      try {
        const base = getNetreaperBase();
        const res = await fetch(`${base}/api/netreaper/report`, {
          headers: { ...netreaperHeaders() }
        });
        if (!res.ok) throw new Error(`Report failed (${res.status})`);
        const data = await res.json();
        netreaperLog(`Report: ${JSON.stringify(data, null, 2)}`, 'ok');
      } catch (err) {
        netreaperLog(`Report error: ${err.message}`, 'warn');
      }
    }

    function netreaperConnectWs() {
      if (!state.netreaper.token) {
        netreaperLog('Authenticate before opening log stream.', 'warn');
        return;
      }
      if (state.netreaper.ws) {
        state.netreaper.ws.close();
        state.netreaper.ws = null;
      }
      const base = getNetreaperBase();
      const wsUrl = base.replace(/^http/, 'ws') + '/ws/netreaper';
      const ws = new WebSocket(wsUrl);
      state.netreaper.ws = ws;

      ws.onopen = () => {
        ws.send(JSON.stringify({ token: state.netreaper.token }));
        netreaperLog('NetReaper log stream connected.', 'ok');
      };
      ws.onmessage = (event) => {
        try {
          const data = JSON.parse(event.data);
          if (data.output) netreaperLog(data.output, 'dim');
          if (data.error) netreaperLog(data.error, 'warn');
        } catch (_) {
          netreaperLog(event.data, 'dim');
        }
      };
      ws.onerror = () => {
        netreaperLog('NetReaper log stream error.', 'warn');
      };
      ws.onclose = () => {
        netreaperLog('NetReaper log stream closed.', 'warn');
        state.netreaper.ws = null;
      };
    }

    function formatTags(tags){
      if (!tags || !tags.length) return '<span class="monoDim">none</span>';
      return tags.map(t => `<span class="pill"><span class="dot"></span>${t}</span>`).join(' ');
    }

    function dotForOnline(online){
      return online ? `<span class="pill"><span class="dot ok"></span>ONLINE</span>` : `<span class="pill"><span class="dot bad"></span>OFFLINE</span>`;
    }

    function logTerm(msg, cls='dim'){
      const el = document.createElement('div');
      el.className = `termLine ${cls}`;
      el.textContent = msg;
      $('termBody').appendChild(el);
      $('termBody').scrollTop = $('termBody').scrollHeight;
    }

    function audit(actor, action, target, result){
      state.audit.unshift({ time: now(), actor, action, target, result });
      renderAudit();
      bumpCounts();
    }

    function addAlert(sev, event, device){
      state.alerts.unshift({ time: now(), sev, event, device });
      renderAlerts();
      bumpCounts();
    }

    function formatLastSeen(ts){
      if (!ts) return '—';
      return new Date(ts).toLocaleString();
    }

    function normalizeDevice(d){
      const openPorts = Array.isArray(d.openPorts) ? d.openPorts : [];
      const bannerList = d.banners ? Object.entries(d.banners).map(([p, b]) => `${p}:${b}`) : [];
      return {
        id: d.id,
        online: !!d.online,
        hostname: d.hostname || d.ip || 'unknown',
        ip: d.ip || '0.0.0.0',
        ipHistory: [d.ip || '0.0.0.0'],
        mac: d.mac || '—',
        vendor: d.vendor || 'Unknown',
        os: d.os || 'Unknown',
        ports: openPorts.length ? openPorts.join(',') : '—',
        services: bannerList.length ? bannerList.join(' | ') : '—',
        names: d.hostname ? `mDNS: ${d.hostname}` : '—',
        tags: d.tags || [],
        lastSeen: formatLastSeen(d.lastSeen),
        lastSeenTs: d.lastSeen || 0,
        changeScore: 0
      };
    }

    async function refreshDevices(){
      try {
        const list = await api('/api/v1/discovery/results');
        state.devices = Array.isArray(list) ? list.map(normalizeDevice) : [];
        renderAll();
      } catch (err) {
        logTerm(`[${now()}] Device refresh failed: ${err.message}`, 'warn');
      }
    }

    async function refreshMetrics(){
      try {
        state.metrics = await api('/api/v1/metrics');
      } catch (_) {
        state.metrics = {};
      }
    }

    async function refreshNetworkInfo(){
      try {
        const info = await api('/api/v1/network/info');
        $('netName').textContent = info.name || 'Network';
        $('netCidr').textContent = info.cidr || $('netCidr').textContent;
        $('netGw').textContent = info.gateway || '—';
      } catch (_) {
        $('netName').textContent = 'Network';
      }
    }

    async function refreshSchedules(){
      try {
        const res = await api('/api/v1/schedules');
        state.schedules = Array.isArray(res) ? res : [];
      } catch (_) {
        state.schedules = [];
      }
      renderSchedules();
    }

    async function refreshRules(){
      try {
        const res = await api('/api/v1/rules');
        state.rules = Array.isArray(res) ? res : [];
      } catch (_) {
        state.rules = [];
      }
      renderRules();
    }

    async function bootstrap(){
      renderAll();
      getNetreaperBase();
      setNetreaperStatus('DISCONNECTED');
      logTerm(`[${now()}] NEON-NOC initialized. Type "help" in the terminal.`, 'ok');
      $('healthLight').className = 'statusLight ok';
      $('healthText').textContent = 'ENGINE: CONNECTED';
      $('buildBadge').textContent = 'LOCAL ENGINE: CONNECTED';
      await refreshNetworkInfo();
      await refreshMetrics();
      await refreshSchedules();
      await refreshRules();
      await refreshDevices();
      if (state.streaming) setStreaming(true);
      setInterval(refreshMetrics, 5000);
    }

    // ==============================
    // Rendering
    // ==============================
    function setView(view){
      state.view = view;
      document.querySelectorAll('.nav a').forEach(b => b.classList.toggle('active', b.dataset.view === view));
      document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
      $(`view-${view}`).classList.remove('hidden');
      const titles = {
        overview: 'Overview',
        devices: 'Devices',
        discovery: 'Discovery',
        actions: 'Actions',
        automation: 'Automation',
        alerts: 'Alerts',
        netreaper: 'NetReaper',
        settings: 'Settings',
        logs: 'Audit Logs',
      };
      $('mainTitle').textContent = titles[view] || view;
    }

    function filteredDevices(){
      const q = state.search.trim().toLowerCase();
      let list = [...state.devices];

      if (q){
        list = list.filter(d => {
          const hay = [
            d.hostname, d.ip, d.mac, d.vendor, d.os,
            d.tags.join(','), d.services, d.ports, d.names
          ].join(' ').toLowerCase();
          return hay.includes(q);
        });
      }

      // Chip filters
      for (const f of state.filters){
        if (f === 'online') list = list.filter(d => d.online);
        else if (f === 'offline') list = list.filter(d => !d.online);
        else if (f.startsWith('os:')){
          const os = f.split(':')[1];
          list = list.filter(d => d.os.toLowerCase() === os);
        } else if (f.startsWith('vendor:')){
          const v = f.split(':')[1].replace('-', ' ');
          list = list.filter(d => d.vendor.toLowerCase().replace('-', ' ') === v);
        } else if (f.startsWith('tag:')){
          const t = f.split(':')[1];
          list = list.filter(d => d.tags.includes(t));
        }
      }

      return list;
    }

    function renderOverview(){
      const list = filteredDevices().slice(0, 10);
      $('recentBody').innerHTML = list.map(d => `
        <tr data-id="${d.id}">
          <td>${dotForOnline(d.online)}</td>
          <td>${d.hostname}</td>
          <td>${d.ip}</td>
          <td>${d.mac}</td>
          <td>${d.vendor}</td>
          <td>${d.os}</td>
          <td>${formatTags(d.tags)}</td>
        </tr>
      `).join('') || `<tr><td colspan="7" class="monoDim">No devices yet. Hit SCAN.</td></tr>`;

      const total = state.devices.length;
      const online = state.devices.filter(d => d.online).length;
      const offline = total - online;

      $('statDevices').textContent = total;
      $('statOnline').textContent = online;
      $('statOffline').textContent = offline;

      $('statNew').textContent = '0';
      $('statChanged').textContent = '0';

      wireRowClicks($('recentBody'));
    }

    function renderDevices(){
      const list = filteredDevices();
      $('devicesBody').innerHTML = list.map(d => `
        <tr data-id="${d.id}" class="${d.id === state.selectedId ? 'selected' : ''}">
          <td><input type="checkbox" class="selBox" data-id="${d.id}"/></td>
          <td>${dotForOnline(d.online)}</td>
          <td>${d.hostname}</td>
          <td>${d.ip}</td>
          <td>${d.ipHistory.join(', ')}</td>
          <td>${d.mac}</td>
          <td>${d.vendor}</td>
          <td>${d.ports}</td>
          <td>${d.services}</td>
          <td>${d.names}</td>
          <td>${formatTags(d.tags)}</td>
        </tr>
      `).join('') || `<tr><td colspan="11" class="monoDim">No devices. Scan the network. Politely.</td></tr>`;

      wireRowClicks($('devicesBody'));
      wireSelectionBoxes();
    }

    function renderDetail(){
      const d = state.devices.find(x => x.id === state.selectedId);
      const enable = !!d;

      $('selBadge').textContent = d ? `SELECTED: ${d.hostname}` : 'NONE SELECTED';
      $('selSub').textContent = d ? `${d.ip}  •  ${d.vendor}  •  ${d.os}` : 'Click any device row';

      // buttons
      ['dPing','dWol','dHttp','dSsh','dSnmp','tagInput','addTag','removeTag'].forEach(id => $(id).disabled = !enable);
      // bulk buttons depend on selections
      updateBulkButtons();

      if (!d){
        $('detailKv').innerHTML = `
          <div class="k">Hostname</div><div class="v">—</div>
          <div class="k">IP</div><div class="v">—</div>
          <div class="k">MAC</div><div class="v">—</div>
          <div class="k">Vendor</div><div class="v">—</div>
          <div class="k">OS guess</div><div class="v">—</div>
          <div class="k">Names</div><div class="v">mDNS/SSDP: —</div>
          <div class="k">Ports</div><div class="v">—</div>
          <div class="k">Services</div><div class="v">—</div>
          <div class="k">IP history</div><div class="v">—</div>
          <div class="k">Tags</div><div class="v">—</div>
        `;
        $('mRtt').textContent = '—';
        $('mHttp').textContent = '—';
        $('mSeen').textContent = '—';
        $('mChange').textContent = '—';
        return;
      }

      $('detailKv').innerHTML = `
        <div class="k">Hostname</div><div class="v">${d.hostname}</div>
        <div class="k">IP</div><div class="v">${d.ip}</div>
        <div class="k">MAC</div><div class="v">${d.mac}</div>
        <div class="k">Vendor</div><div class="v">${d.vendor}</div>
        <div class="k">OS guess</div><div class="v">${d.os}</div>
        <div class="k">Names</div><div class="v">${d.names}</div>
        <div class="k">Ports</div><div class="v">${d.ports}</div>
        <div class="k">Services</div><div class="v">${d.services}</div>
        <div class="k">IP history</div><div class="v">${d.ipHistory.join(', ')}</div>
        <div class="k">Tags</div><div class="v">${d.tags.length ? d.tags.join(', ') : 'none'}</div>
      `;

      const metrics = state.deviceMetrics.get(d.id) || {};
      $('mRtt').textContent = metrics.rttMs != null ? `${metrics.rttMs} ms` : '—';
      $('mHttp').textContent = metrics.httpStatus != null ? `${metrics.httpStatus}` : '—';
      $('mSeen').textContent = d.lastSeen;
      $('mChange').textContent = metrics.changeScore != null ? `${metrics.changeScore}` : '—';
    }

    function renderAudit(){
      $('auditBody').innerHTML = state.audit.map(a => `
        <tr>
          <td>${a.time}</td>
          <td>${a.actor}</td>
          <td>${a.action}</td>
          <td>${a.target}</td>
          <td>${a.result}</td>
        </tr>
      `).join('') || `<tr><td colspan="5" class="monoDim">No audit entries yet.</td></tr>`;
    }

    function renderAlerts(){
      $('alertsBody').innerHTML = state.alerts.map(a => `
        <tr>
          <td>${a.time}</td>
          <td>${a.sev}</td>
          <td>${a.event}</td>
          <td>${a.device}</td>
        </tr>
      `).join('') || `<tr><td colspan="4" class="monoDim">No alerts yet.</td></tr>`;
    }

    function bumpCounts(){
      $('cntDevices').textContent = String(state.devices.length);
      $('cntLogs').textContent = String(state.audit.length);
      $('cntAlerts').textContent = String(state.alerts.length);
      const netreaperJobs = state.netreaper.jobs.length;
      if ($('cntNetreaper')) $('cntNetreaper').textContent = String(netreaperJobs);
    }

    function renderJob(){
      $('jobsCount').textContent = state.job.active ? '1 active' : '0 active';
      $('jobName').textContent = state.job.name;
      $('jobPhase').textContent = state.job.phase;
      $('jobFound').textContent = String(state.job.found);
      $('jobStream').textContent = state.streaming ? 'ON' : 'OFF';

      $('jobProg').style.width = `${state.job.progress}%`;
      $('jobProg2').style.width = `${state.job.progress}%`;

      $('streamBadge').textContent = `STREAM: ${state.streaming ? 'ON' : 'OFF'}`;
      $('wsBadge').textContent = state.job.active ? 'WS: STREAMING' : 'WS: IDLE';
      $('opsBadge').textContent = state.job.active ? (state.job.paused ? 'PAUSED' : 'RUNNING') : 'READY';
      $('streamBadge').style.color = state.streaming ? 'rgba(34,211,238,0.9)' : 'rgba(255,255,255,0.65)';
    }

    function renderSchedules(){
      $('schedules').innerHTML = state.schedules.length
        ? state.schedules.map((s,i)=>`[${i+1}] ${s}`).join('<br/>')
        : 'No schedules (yet).';
    }

    function renderRules(){
      $('rules').innerHTML = state.rules.length
        ? state.rules.map((r,i)=>`[${i+1}] WHEN ${r.match} → DO ${r.action}`).join('<br/>')
        : 'No rules (yet).';
    }

    function renderAll(){
      renderOverview();
      renderDevices();
      renderDetail();
      renderAudit();
      renderAlerts();
      renderJob();
      renderSchedules();
      renderRules();
      bumpCounts();
    }

    // ==============================
    // Interactions
    // ==============================
    function wireRowClicks(tbody){
      tbody.querySelectorAll('tr[data-id]').forEach(tr => {
        tr.addEventListener('click', (e) => {
          // ignore checkbox click so row selection still works
          if (e.target && e.target.classList.contains('selBox')) return;
          state.selectedId = tr.dataset.id;
          document.querySelectorAll('tbody tr').forEach(x => x.classList.toggle('selected', x.dataset.id === state.selectedId));
          renderDetail();
        });
      });
    }

    function selectedIds(){
      return Array.from(document.querySelectorAll('.selBox:checked')).map(x => x.dataset.id);
    }

    function updateBulkButtons(){
      const any = selectedIds().length > 0;
      ['tagBtn','bulkPingBtn','bulkWolBtn','bulkHttpBtn','bulkSshBtn'].forEach(id => $(id).disabled = !any);
    }

    function wireSelectionBoxes(){
      document.querySelectorAll('.selBox').forEach(box => {
        box.addEventListener('change', updateBulkButtons);
      });
      updateBulkButtons();
    }

    function toggleChip(chipEl){
      const key = chipEl.dataset.chip;
      if (chipEl.classList.contains('on')){
        chipEl.classList.remove('on');
        state.filters.delete(key);
      } else {
        chipEl.classList.add('on');
        state.filters.add(key);
      }
      renderAll();
    }

    function setStreaming(on){
      state.streaming = on;
      if (on) {
        if (state.streamTimer) clearInterval(state.streamTimer);
        state.streamTimer = setInterval(refreshDevices, 2500);
      } else if (state.streamTimer) {
        clearInterval(state.streamTimer);
        state.streamTimer = null;
      }
      renderJob();
    }

    function toggleToggle(el){
      el.classList.toggle('on');
      if (el.id === 't_stream') setStreaming(el.classList.contains('on'));
    }

    // ==============================
    // Scan + Stream
    // ==============================
    async function startScan(label){
      if (state.job.active) {
        logTerm(`[${now()}] Scan request denied: job already active.`, 'warn');
        return;
      }

      state.job.active = true;
      state.job.paused = false;
      state.job.name = label;
      state.job.phase = 'Scanning';
      state.job.found = 0;
      state.job.progress = 5;

      $('healthLight').className = 'statusLight ok';
      $('healthText').textContent = 'ENGINE: RUNNING JOB';
      $('jobPause').disabled = false;
      $('jobResume').disabled = false;
      $('jobCancel').disabled = false;

      audit('admin', 'SCAN_START', label, 'OK');
      logTerm(`[${now()}] Starting scan: ${label}`, 'ok');
      renderJob();

      let tick = 0;
      state.job.timer = setInterval(() => {
        if (!state.job.active || state.job.paused) return;
        tick++;
        state.job.progress = Math.min(95, state.job.progress + 2);
        renderJob();
      }, 300);

      try {
        const cidr = $('cidr').value.trim();
        const list = await postJson('/api/v1/discovery/scan', { subnet: cidr || null, timeoutMs: 350 });
        state.devices = Array.isArray(list) ? list.map(normalizeDevice) : [];
        state.job.found = state.devices.length;
        logTerm(`[${now()}] Scan complete. Found ${state.job.found} devices.`, 'ok');
        await refreshMetrics();
        renderAll();
      } catch (err) {
        logTerm(`[${now()}] Scan failed: ${err.message}`, 'bad');
      } finally {
        clearInterval(state.job.timer);
        state.job.timer = null;
        state.job.active = false;
        state.job.phase = 'Complete';
        state.job.progress = 100;
        $('healthText').textContent = 'ENGINE: IDLE';
        $('wsBadge').textContent = 'WS: IDLE';
        renderJob();
      }
    }

    function cancelJob(reason){
      if (!state.job.active) return;
      clearInterval(state.job.timer);
      state.job.timer = null;
      state.job.active = false;
      state.job.phase = 'Cancelled';
      audit('admin', 'JOB_CANCEL', state.job.name, reason);
      logTerm(`[${now()}] Job cancelled: ${reason}`, 'bad');
      renderJob();
    }

    // ==============================
    // Actions
    // ==============================
    async function actOnDevice(action, d){
      if (!d) return;
      const tgt = `${d.hostname} (${d.ip})`;
      audit('admin', action, tgt, 'REQUEST');
      logTerm(`[${now()}] ACTION ${action} → ${tgt}`, 'ok');

      try {
        let res = null;
        if (action === 'PING'){
          res = await postJson('/api/v1/actions/ping', { ip: d.ip });
          const metrics = state.deviceMetrics.get(d.id) || {};
          metrics.rttMs = res.rttMs ?? null;
          state.deviceMetrics.set(d.id, metrics);
          logTerm(`PING ${d.ip}: ${res.ok ? `time=${res.rttMs ?? '-'}ms` : 'timeout'}`, res.ok ? 'ok' : 'warn');
        } else if (action === 'WOL'){
          res = await postJson('/api/v1/actions/wol', { mac: d.mac });
          logTerm(`WOL magic packet ${res.ok ? 'sent' : 'failed'} to ${d.mac}`, res.ok ? 'ok' : 'warn');
        } else if (action === 'HTTP_CHECK'){
          const url = `http://${d.ip}/`;
          res = await postJson('/api/v1/actions/http', { url });
          const metrics = state.deviceMetrics.get(d.id) || {};
          metrics.httpStatus = res.status ?? null;
          state.deviceMetrics.set(d.id, metrics);
          logTerm(`HTTP GET ${url} => ${res.status || 'n/a'}`, res.ok ? 'dim' : 'warn');
        } else if (action === 'SNMP_GET'){
          res = await postJson('/api/v1/actions/snmp', { ip: d.ip });
          logTerm(`SNMP probe ${d.ip}: ${res.ok ? 'reachable' : 'no response'}`, res.ok ? 'dim' : 'warn');
        } else if (action === 'SSH'){
          res = await postJson('/api/v1/actions/ssh', { ip: d.ip });
          logTerm(`SSH port ${res.ok ? 'open' : 'closed'} on ${d.ip}`, res.ok ? 'dim' : 'warn');
        }

        audit('admin', action, tgt, res && res.ok ? 'OK' : 'FAIL');
      } catch (err) {
        audit('admin', action, tgt, 'ERROR');
        logTerm(`[${now()}] ACTION ${action} failed: ${err.message}`, 'bad');
      }
    }

    async function actOnMany(action, ids){
      const list = state.devices.filter(d => ids.includes(d.id));
      if (!list.length) return;
      audit('admin', `BULK_${action}`, `${list.length} devices`, 'REQUEST');
      logTerm(`[${now()}] BULK ${action} on ${list.length} devices`, 'ok');
      for (const d of list) {
        await actOnDevice(action, d);
      }
    }

    // ==============================
    // Wire UI
    // ==============================
    function wireUI(){
      // Navigation
      $('nav').addEventListener('click', (e) => {
        const btn = e.target.closest('a[data-view]');
        if (!btn) return;
        e.preventDefault();
        setView(btn.dataset.view);
        renderAll();
      });

      // Search
      $('search').addEventListener('input', (e) => {
        state.search = e.target.value;
        renderAll();
      });

      // Chips
      $('chips').addEventListener('click', (e) => {
        const chip = e.target.closest('.chip');
        if (!chip) return;
        toggleChip(chip);
      });

      // Advanced menu
      $('advancedBtn').addEventListener('click', () => $('advancedMenu').classList.toggle('hidden'));
      $('closeAdvanced').addEventListener('click', () => $('advancedMenu').classList.add('hidden'));
      $('runAdvanced').addEventListener('click', () => {
        $('advancedMenu').classList.add('hidden');
        const mode = $('scanMode').value.toUpperCase();
        $('netCidr').textContent = $('cidr').value;
        startScan(`ADVANCED_${mode} ${$('cidr').value}`);
      });

      // Toggles in Advanced
      ['t_icmp','t_arp','t_mdns','t_ssdp','t_snmp','t_stream','t_cache','t_tooltips','t_audit'].forEach(id => {
        const el = $(id);
        if (!el) return;
        el.addEventListener('click', () => toggleToggle(el));
      });

      // Main buttons
      $('scanBtn').addEventListener('click', () => startScan('SCAN_LAN_FAST'));
      $('panicBtn').addEventListener('click', () => $('panicModal').classList.add('show'));
      $('panicClose').addEventListener('click', () => $('panicModal').classList.remove('show'));
      $('panicConfirm').addEventListener('click', () => {
        $('panicModal').classList.remove('show');
        cancelJob('PANIC_STOP');
      });

      // NetReaper controls
      $('netreaperAuthBtn').addEventListener('click', (e) => {
        e.preventDefault();
        netreaperAuth();
      });
      $('netreaperWsBtn').addEventListener('click', (e) => {
        e.preventDefault();
        netreaperConnectWs();
      });
      $('netreaperScanBtn').addEventListener('click', (e) => {
        e.preventDefault();
        netreaperScan();
      });
      $('netreaperDevicesBtn').addEventListener('click', (e) => {
        e.preventDefault();
        netreaperDevices();
      });
      $('netreaperReportBtn').addEventListener('click', (e) => {
        e.preventDefault();
        netreaperReport();
      });
      $('netreaperUrl').addEventListener('change', (e) => {
        localStorage.setItem('netreaperUrl', e.target.value.trim());
        setNetreaperStatus('DISCONNECTED');
      });

      $('exportBtn').addEventListener('click', () => {
        api('/api/v1/export/devices').then(data => {
          const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `netninja_devices_${Date.now()}.json`;
          a.click();
          URL.revokeObjectURL(url);
          audit('admin', 'EXPORT', 'device_inventory', 'OK');
          logTerm(`[${now()}] Export ready (JSON).`, 'ok');
        }).catch(err => {
          audit('admin', 'EXPORT', 'device_inventory', 'FAIL');
          logTerm(`[${now()}] Export failed: ${err.message}`, 'bad');
        });
      });

      // Discovery infer
      $('inferBtn').addEventListener('click', () => {
        api('/api/v1/network/info').then(info => {
          if (info.cidr) $('netCidr').textContent = info.cidr;
          if (info.gateway) $('netGw').textContent = info.gateway;
          $('inferOut').textContent = `Inferred: ${$('netCidr').textContent}`;
          audit('admin', 'SUBNET_INFER', $('netCidr').textContent, 'OK');
          logTerm(`[${now()}] Subnet inference complete: ${$('netCidr').textContent}`, 'ok');
        }).catch(err => {
          audit('admin', 'SUBNET_INFER', $('netCidr').textContent, 'FAIL');
          logTerm(`[${now()}] Subnet inference failed: ${err.message}`, 'bad');
        });
      });

      // Job controls
      $('jobPause').addEventListener('click', () => {
        if (!state.job.active) return;
        state.job.paused = true;
        audit('admin', 'JOB_PAUSE', state.job.name, 'OK');
        logTerm(`[${now()}] Job paused.`, 'warn');
        renderJob();
      });
      $('jobResume').addEventListener('click', () => {
        if (!state.job.active) return;
        state.job.paused = false;
        audit('admin', 'JOB_RESUME', state.job.name, 'OK');
        logTerm(`[${now()}] Job resumed.`, 'ok');
        renderJob();
      });
      $('jobCancel').addEventListener('click', () => cancelJob('USER_CANCEL'));

      // Detail actions
      $('dPing').addEventListener('click', () => actOnDevice('PING', state.devices.find(d=>d.id===state.selectedId)));
      $('dWol').addEventListener('click', () => actOnDevice('WOL', state.devices.find(d=>d.id===state.selectedId)));
      $('dHttp').addEventListener('click', () => actOnDevice('HTTP_CHECK', state.devices.find(d=>d.id===state.selectedId)));
      $('dSnmp').addEventListener('click', () => actOnDevice('SNMP_GET', state.devices.find(d=>d.id===state.selectedId)));
      $('dSsh').addEventListener('click', () => openSshModalForSelected());

      // Global actions view buttons (act on selected device)
      $('actPing').addEventListener('click', () => $('dPing').click());
      $('actWol').addEventListener('click', () => $('dWol').click());
      $('actHttp').addEventListener('click', () => $('dHttp').click());
      $('actSnmp').addEventListener('click', () => $('dSnmp').click());
      $('actSsh').addEventListener('click', () => $('dSsh').click());

      // Bulk actions
      $('bulkPingBtn').addEventListener('click', () => actOnMany('PING', selectedIds()));
      $('bulkWolBtn').addEventListener('click', () => actOnMany('WOL', selectedIds()));
      $('bulkHttpBtn').addEventListener('click', () => actOnMany('HTTP_CHECK', selectedIds()));
      $('bulkSshBtn').addEventListener('click', () => {
        const ids = selectedIds();
        if (!ids.length) return;
        state.bulkSshIds = ids;
        audit('admin', 'BULK_SSH', `${ids.length} devices`, 'OPEN_MODAL');
        $('sshHost').value = `(${ids.length} targets)`;
        $('sshModal').classList.add('show');
      });

      // Tagging
      $('addTag').addEventListener('click', () => {
        const d = state.devices.find(x => x.id === state.selectedId);
        const tag = $('tagInput').value.trim().toLowerCase();
        if (!d || !tag) return;
        if (!d.tags.includes(tag)) d.tags.push(tag);
        $('tagInput').value = '';
        audit('admin','TAG_ADD', `${d.hostname} (${d.ip})`, tag);
        renderAll();
      });
      $('removeTag').addEventListener('click', () => {
        const d = state.devices.find(x => x.id === state.selectedId);
        const tag = $('tagInput').value.trim().toLowerCase();
        if (!d || !tag) return;
        d.tags = d.tags.filter(t => t !== tag);
        $('tagInput').value = '';
        audit('admin','TAG_REMOVE', `${d.hostname} (${d.ip})`, tag);
        renderAll();
      });

      // Schedules + rules
      $('addSchedule').addEventListener('click', () => {
        const s = $('schedFreq').value;
        postJson('/api/v1/schedules', { subnet: $('netCidr').textContent, freq: s }).then(() => {
          audit('admin','SCHEDULE_ADD', 'scan', s);
          refreshSchedules();
        }).catch(err => {
          audit('admin','SCHEDULE_ADD', 'scan', 'FAIL');
          logTerm(`[${now()}] Schedule add failed: ${err.message}`, 'bad');
        });
      });
      $('pauseSchedules').addEventListener('click', () => {
        postJson('/api/v1/schedules/pause', {}).then(() => {
          audit('admin','SCHEDULE_PAUSE_ALL', 'scan', 'OK');
          logTerm(`[${now()}] Schedules paused.`, 'warn');
        }).catch(err => {
          audit('admin','SCHEDULE_PAUSE_ALL', 'scan', 'FAIL');
          logTerm(`[${now()}] Schedule pause failed: ${err.message}`, 'bad');
        });
      });
      $('addRule').addEventListener('click', () => {
        const match = $('ruleMatch').value.trim();
        const action = $('ruleAction').value;
        if (!match) return;
        postJson('/api/v1/rules', { match, action }).then(() => {
          $('ruleMatch').value = '';
          audit('admin','RULE_ADD', match, action);
          refreshRules();
        }).catch(err => {
          audit('admin','RULE_ADD', match, 'FAIL');
          logTerm(`[${now()}] Rule add failed: ${err.message}`, 'bad');
        });
      });

      // Terminal
      $('termSend').addEventListener('click', termExec);
      $('termInput').addEventListener('keydown', (e) => {
        if (e.key === 'Enter') termExec();
      });

      // SSH modal
      $('sshClose').addEventListener('click', () => $('sshModal').classList.remove('show'));
      $('sshRun').addEventListener('click', () => {
        const host = $('sshHost').value.trim();
        $('sshModal').classList.remove('show');
        const ids = state.bulkSshIds || [];
        if (ids.length) {
          state.bulkSshIds = [];
          actOnMany('SSH', ids);
          return;
        }
        if (!host) return;
        postJson('/api/v1/actions/ssh', { ip: host }).then(res => {
          audit('admin','SSH_RUN', host, res.ok ? 'OK' : 'FAIL');
          logTerm(`[${now()}] SSH probe ${host}: ${res.ok ? 'open' : 'closed'}`, res.ok ? 'ok' : 'warn');
        }).catch(err => {
          audit('admin','SSH_RUN', host, 'ERROR');
          logTerm(`[${now()}] SSH probe failed: ${err.message}`, 'bad');
        });
      });

      // Scope changes
      $('scope').addEventListener('change', (e) => {
        audit('admin','SCOPE_SET', 'scan', e.target.value.toUpperCase());
        logTerm(`[${now()}] Scope set to ${e.target.value.toUpperCase()}.`, 'dim');
      });

      // Close advanced menu on outside click
      document.addEventListener('click', (e) => {
        if (!$('advancedMenu').classList.contains('hidden')){
          const within = e.target.closest('#advancedMenu') || e.target.closest('#advancedBtn');
          if (!within) $('advancedMenu').classList.add('hidden');
        }
      });
    }

    function openSshModalForSelected(){
      const d = state.devices.find(x => x.id === state.selectedId);
      if (!d) return;
      $('sshHost').value = d.ip;
      $('sshUser').value = '';
      $('sshPass').value = '';
      $('sshCmd').value = '';
      $('sshModal').classList.add('show');
    }

    function termExec(){
      const raw = $('termInput').value.trim();
      if (!raw) return;
      $('termInput').value = '';
      logTerm(`noc$ ${raw}`, 'dim');

      const [cmd, ...args] = raw.split(/\s+/);
      const a = args.join(' ');

      if (cmd === 'help'){
        logTerm(`Commands: help | scan | ping <ip> | wol <mac> | select <hostname> | export | clear`, 'ok');
        return;
      }
      if (cmd === 'clear'){
        $('termBody').innerHTML = '';
        return;
      }
      if (cmd === 'scan'){
        startScan('TERM_SCAN');
        return;
      }
      if (cmd === 'export'){
        $('exportBtn').click();
        return;
      }
      if (cmd === 'ping'){
        const ip = args[0];
        if (!ip) return logTerm('usage: ping <ip>', 'warn');
        postJson('/api/v1/actions/ping', { ip }).then(res => {
          logTerm(`PING ${ip}: ${res.ok ? `time=${res.rttMs ?? '-'}ms` : 'timeout'}`, res.ok ? 'ok' : 'warn');
        }).catch(err => {
          logTerm(`PING ${ip}: ${err.message}`, 'bad');
        });
        return;
      }
      if (cmd === 'wol'){
        const mac = args[0];
        if (!mac) return logTerm('usage: wol <mac>', 'warn');
        postJson('/api/v1/actions/wol', { mac }).then(res => {
          logTerm(`WOL ${res.ok ? 'sent' : 'failed'} to ${mac}`, res.ok ? 'ok' : 'warn');
        }).catch(err => {
          logTerm(`WOL ${mac}: ${err.message}`, 'bad');
        });
        return;
      }
      if (cmd === 'select'){
        const name = a.toLowerCase();
        const d = state.devices.find(x => x.hostname.toLowerCase() === name);
        if (!d) return logTerm(`No device named "${a}".`, 'warn');
        state.selectedId = d.id;
        renderAll();
        logTerm(`Selected: ${d.hostname} (${d.ip})`, 'ok');
        return;
      }

      logTerm(`Unknown command: ${cmd} (type help)`, 'warn');
    }

    // Bootstrap
    wireUI();
    seedEmpty();
    renderAll();
  </script>
</div>

<!-- Hidden stubs required by neon_dash.js (task/sub UI) to avoid null errors -->
<div style="display:none">
  <form id="add-task-form"><input id="task-title-input"/><select id="task-category-input"></select></form>
  <div id="task-list"></div>
  <form id="add-sub-form"><input id="sub-name-input"/><input id="sub-price-input"/></form>
  <div id="subscription-list"></div>
  <div id="subscription-total"></div>
  <div id="time"></div>
  <div id="date"></div>
</div>

</body>
</html>
